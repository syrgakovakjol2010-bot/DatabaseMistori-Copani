<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M.C. BOSS | Ultimate Control</title>
    <style>
        /* --- –¶–í–ï–¢–û–í–ê–Ø –ü–ê–õ–ò–¢–†–ê --- 
           –ß–µ—Ä–Ω—ã–π —Ñ–æ–Ω, –±–µ–ª—ã–π —Ç–µ–∫—Å—Ç, –∑–æ–ª–æ—Ç–æ –¥–ª—è –¥–µ–Ω–µ–≥, –∫—Ä–∞—Å–Ω—ã–π –¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π.
        */
        :root {
            --bg: #000000;
            --sidebar-bg: #080808;
            --card-bg: #0c0c0c;
            --border: #1a1a1a;
            --text-main: #ffffff;
            --text-dim: #666666;
            --gold: #ffd700;
            --green: #00ff66;
            --red: #ff3333;
            --blue: #0088ff;
            --purple: #bf00ff;
            --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { 
            background: var(--bg); 
            color: var(--text-main); 
            font-family: 'Inter', -apple-system, system-ui, sans-serif; 
            margin: 0; 
            padding: 0; 
            overflow: hidden; 
            height: 100vh;
        }

        /* --- –°–ö–†–´–¢–´–ï –≠–õ–ï–ú–ï–ù–¢–´ --- */
        .hidden { display: none !important; }

        /* --- –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø --- */
        .auth-container { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            display: flex; align-items: center; justify-content: center; 
            background: var(--bg); z-index: 5000; 
        }
        .auth-card { 
            width: 90%; max-width: 380px; background: var(--card-bg); 
            border: 1px solid var(--border); padding: 40px; border-radius: 28px; 
            text-align: center; box-shadow: 0 20px 80px rgba(0,0,0,0.8);
        }
        .auth-card h1 { font-size: 3.5rem; letter-spacing: 15px; margin: 0; font-weight: 900; }
        .auth-card p { color: var(--text-dim); font-size: 0.7rem; letter-spacing: 3px; margin-bottom: 30px; text-transform: uppercase; }

        input, textarea, select { 
            width: 100%; padding: 16px; margin: 10px 0; background: #111; 
            border: 1px solid #222; color: #fff; border-radius: 14px; 
            font-size: 16px; transition: var(--transition);
        }
        input:focus { border-color: var(--text-main); background: #000; }
        
        .btn { 
            width: 100%; padding: 16px; border-radius: 14px; font-weight: 800; 
            border: none; cursor: pointer; text-transform: uppercase; 
            transition: var(--transition); font-size: 14px; 
        }
        .btn-white { background: var(--text-main); color: #000; }
        .btn-outline { background: transparent; color: var(--text-dim); border: 1px solid #222; margin-top: 15px; }
        .btn-outline:hover { color: #fff; border-color: #fff; }

        /* --- –ì–õ–ê–í–ù–´–ô –ú–ê–ö–ï–¢ --- */
        #app { display: none; height: 100vh; width: 100vw; flex-direction: row; }

        /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å (Desktop) */
        .sidebar { 
            width: 280px; background: var(--sidebar-bg); border-right: 1px solid var(--border); 
            display: flex; flex-direction: column; padding: 30px; z-index: 100;
        }
        .sidebar-logo { font-size: 1.5rem; font-weight: 900; letter-spacing: 5px; margin-bottom: 50px; }
        .nav-list { flex: 1; display: flex; flex-direction: column; gap: 10px; }
        .nav-item { 
            background: transparent; border: none; color: var(--text-dim); 
            padding: 14px 20px; border-radius: 12px; text-align: left; 
            cursor: pointer; font-weight: 600; display: flex; align-items: center; 
            gap: 15px; transition: var(--transition);
        }
        .nav-item:hover, .nav-item.active { background: #151515; color: #fff; }
        .nav-item.active { border-left: 4px solid var(--text-main); }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç–Ω–∞—è —á–∞—Å—Ç—å */
        .main-wrapper { flex: 1; display: flex; flex-direction: column; height: 100vh; position: relative; }
        .top-bar { 
            padding: 15px 30px; display: flex; justify-content: space-between; 
            align-items: center; background: rgba(0,0,0,0.6); backdrop-filter: blur(20px); 
            border-bottom: 1px solid var(--border); z-index: 50;
        }
        .scroll-area { flex: 1; overflow-y: auto; padding: 30px; padding-bottom: 120px; }

        /* --- –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ (GRID) --- */
        .dashboard-stats { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 20px; margin-bottom: 40px; 
        }
        .stat-card { 
            background: var(--card-bg); border: 1px solid var(--border); 
            padding: 25px; border-radius: 24px; position: relative; 
        }
        .stat-card small { font-size: 0.7rem; color: var(--text-dim); text-transform: uppercase; font-weight: bold; }
        .stat-card b { display: block; font-size: 1.8rem; margin-top: 10px; font-weight: 900; }
        .gold-text { color: var(--gold); }

        .orders-grid { 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); 
            gap: 20px; 
        }

        /* --- –ö–ê–†–¢–û–ß–ö–ê –ó–ê–ö–ê–ó–ê --- */
        .order-card { 
            background: var(--card-bg); border: 1px solid var(--border); 
            padding: 25px; border-radius: 28px; position: relative; 
            transition: var(--transition); display: flex; flex-direction: column;
        }
        .order-card:hover { border-color: #444; transform: translateY(-5px); }
        .price-badge { 
            position: absolute; top: 25px; right: 25px; color: var(--gold); 
            font-weight: 900; background: rgba(255,215,0,0.05); 
            border: 1px solid var(--gold); padding: 5px 12px; border-radius: 10px; 
        }
        .ref-area { 
            background: #050505; border: 1px dashed #333; padding: 12px; 
            border-radius: 12px; margin: 15px 0; font-size: 0.8rem; color: var(--blue);
            word-break: break-all;
        }
        .status-badge { 
            display: inline-block; font-size: 0.65rem; font-weight: bold; 
            padding: 4px 10px; border-radius: 6px; text-transform: uppercase; 
            border: 1px solid #333; margin-top: auto; align-self: flex-start;
        }
        .st-new { color: var(--green); border-color: var(--green); }
        .st-work { color: var(--blue); border-color: var(--blue); }
        .st-rejected { color: var(--red); border-color: var(--red); opacity: 0.6; }

        /* --- –ö–û–ú–ê–ù–î–ê --- */
        .team-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .staff-card { 
            background: var(--card-bg); border: 1px solid var(--border); 
            padding: 20px; border-radius: 24px; display: flex; align-items: center; gap: 20px; 
        }
        .avatar-circle { 
            width: 60px; height: 60px; border-radius: 50%; background: #1a1a1a; 
            display: flex; align-items: center; justify-content: center; 
            font-weight: 900; font-size: 1.2rem; border: 1px solid #333;
        }
        .warn-dot { width: 10px; height: 10px; background: #222; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .warn-active { background: var(--red); box-shadow: 0 0 10px var(--red); }
        
        /* –†–∞–Ω–≥–∏ */
        .rank-tag { font-size: 0.6rem; padding: 2px 6px; border-radius: 4px; font-weight: bold; margin-left: 5px; }
        .rank-jun { background: #333; color: #fff; }
        .rank-mid { background: var(--blue); color: #fff; }
        .rank-sen { background: var(--purple); color: #fff; box-shadow: 0 0 8px var(--purple); }

        /* --- –ú–û–ë–ò–õ–¨–ù–ê–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø --- */
        .bottom-nav { 
            position: fixed; bottom: 0; width: 100%; height: 80px; 
            background: rgba(5,5,5,0.9); backdrop-filter: blur(20px); 
            border-top: 1px solid var(--border); display: none; 
            justify-content: space-around; align-items: center; padding-bottom: 20px; z-index: 1000; 
        }
        .mobile-btn { 
            background: none; border: none; color: var(--text-dim); 
            font-size: 0.6rem; font-weight: bold; display: flex; 
            flex-direction: column; align-items: center; gap: 5px; 
            text-transform: uppercase;
        }
        .mobile-btn.active { color: #fff; }

        /* --- –ü–õ–ê–ù–®–ï–¢/–ú–û–ë–ò–õ–ö–ê --- */
        @media (max-width: 1024px) {
            .sidebar { display: none; }
            .bottom-nav { display: flex; }
            .top-bar { padding: 15px 20px; }
            .scroll-area { padding: 20px; }
            .orders-grid { grid-template-columns: 1fr; }
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        #toast { 
            position: fixed; top: 30px; left: 50%; transform: translateX(-50%); 
            background: #fff; color: #000; padding: 15px 35px; border-radius: 50px; 
            font-weight: 900; display: none; z-index: 6000; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.5); 
        }
    </style>
</head>
<body>

    <div id="toast"></div>

    <div id="auth-screen" class="auth-container">
        <div class="auth-card">
            <h1>M.C.</h1>
            <p>Mistori Copani BOSS v16.0</p>
            <input type="text" id="l-phone" placeholder="705163333">
            <input type="password" id="l-pass" placeholder="–ü–∞—Ä–æ–ª—å">
            <button class="btn btn-white" onclick="onLogin()">–í–•–û–î –í –¢–ï–†–ú–ò–ù–ê–õ</button>
            <button class="btn btn-outline" onclick="toggleView(true)">–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</button>
            <p onclick="systemReset()" style="margin-top:30px; font-size:0.5rem; cursor:pointer; opacity:0.2;">HARD RESET SYSTEM</p>
        </div>
    </div>

    <div id="reg-screen" class="auth-container hidden">
        <div class="auth-card">
            <h2>NEW ID</h2>
            <input type="text" id="r-name" placeholder="–ò–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞">
            <input type="text" id="r-phone" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞">
            <input type="password" id="r-pass" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å">
            <button class="btn btn-white" onclick="onReg()">–°–û–ó–î–ê–¢–¨ –ê–ö–ö–ê–£–ù–¢</button>
            <button class="btn btn-outline" onclick="toggleView(false)">–ù–ê–ó–ê–î</button>
        </div>
    </div>

    <div id="app">
        <div class="sidebar">
            <div class="sidebar-logo">MISTORI</div>
            <div class="nav-list">
                <button class="nav-item active" id="pc-orders" onclick="tab('orders')">üíº –ü–†–û–ï–ö–¢–´</button>
                <button class="nav-item" id="pc-add" onclick="tab('add')">‚ûï –ù–û–í–´–ô –ó–ê–ö–ê–ó</button>
                <button class="nav-item" id="pc-team" onclick="tab('team')">üë• –ö–û–ú–ê–ù–î–ê</button>
                <button class="nav-item" id="pc-fin" onclick="tab('fin')">üìà –ê–ù–ê–õ–ò–¢–ò–ö–ê</button>
            </div>
            <button class="nav-item" onclick="location.reload()" style="color:var(--red); border:1px solid #222;">–í–´–•–û–î</button>
        </div>

        <div class="main-wrapper">
            <div class="top-bar">
                <div style="display:flex; align-items:center; gap:15px;">
                    <div id="me-ava" style="width:35px; height:35px; background:#222; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:0.8rem; border:1px solid #444;">A</div>
                    <div>
                        <b id="me-name">Akjol</b> <br>
                        <small id="me-role" style="color:var(--green); font-size:0.6rem; text-transform:uppercase;"></small>
                    </div>
                </div>
                <div style="font-weight:900; letter-spacing:5px; font-size:0.8rem; opacity:0.5;">BOSS TERMINAL</div>
            </div>

            <div class="scroll-area" id="view-port">
                </div>

            <div class="bottom-nav">
                <button class="mobile-btn active" id="mb-orders" onclick="tab('orders')">üì¶<br>–ó–ê–ö–ê–ó–´</button>
                <button class="mobile-btn" id="mb-add" onclick="tab('add')">‚ûï<br>–ù–û–í–´–ô</button>
                <button class="mobile-btn" id="mb-team" onclick="tab('team')">üë•<br>–ö–û–ú–ê–ù–î–ê</button>
                <button class="mobile-btn" id="mb-fin" onclick="tab('fin')">üìä<br>–ö–ê–°–°–ê</button>
            </div>
        </div>
    </div>

    <script>
        /* --- CORE LOGIC --- */

        // –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Persistent)
        let DB = JSON.parse(localStorage.getItem('mc_boss_v16')) || {
            users: [
                { name: "–°–µ–∑–∏–º", phone: "777800603", pass: "admin2", role: "manager", xp: 5, warns: 0 }
            ],
            orders: []
        };

        let me = null;
        let activeTab = 'orders';

        // 1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
        function onLogin() {
            const ph = document.getElementById('l-phone').value.trim();
            const ps = document.getElementById('l-pass').value.trim();

            if (ph === '705163333' && ps === 'admin123') {
                me = { name: "–ê–∫–∂–æ–ª", phone: ph, role: "director", xp: 999, warns: 0 };
                initApp();
            } else {
                let u = DB.users.find(x => x.phone === ph && x.pass === ps);
                if (u) { me = u; initApp(); } 
                else { showMsg('–û–®–ò–ë–ö–ê: –î–û–°–¢–£–ü –ó–ê–ü–†–ï–©–ï–ù'); }
            }
        }

        function onReg() {
            const n = document.getElementById('r-name').value;
            const p = document.getElementById('r-phone').value;
            const ps = document.getElementById('r-pass').value;
            if(!n || !p || !ps) return showMsg('–ó–ê–ü–û–õ–ù–ò–¢–ï –í–°–ï –ü–û–õ–Ø');
            if(DB.users.find(u => u.phone === p) || p === '705163333') return showMsg('–ù–û–ú–ï–† –£–ñ–ï –ó–ê–ù–Ø–¢');

            DB.users.push({ name: n, phone: p, pass: ps, role: "programmer", xp: 0, warns: 0 });
            save(); 
            showMsg('ID –°–û–ó–î–ê–ù. –ú–û–ñ–ù–û –í–•–û–î–ò–¢–¨');
            setTimeout(() => location.reload(), 1000);
        }

        function initApp() {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('reg-screen').classList.add('hidden');
            document.getElementById('app').style.display = 'flex';
            document.getElementById('me-name').innerText = me.name;
            document.getElementById('me-role').innerText = me.role;
            document.getElementById('me-ava').innerText = me.name[0];
            tab('orders');
        }

        // 2. –ù–∞–≤–∏–≥–∞—Ü–∏—è
        function tab(t) {
            activeTab = t;
            const port = document.getElementById('view-port');
            
            // UI –ü–ö
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            const pcBtn = document.getElementById('pc-' + t);
            if(pcBtn) pcBtn.classList.add('active');

            // UI –ú–æ–±–∏–ª–∫–∞
            document.querySelectorAll('.mobile-btn').forEach(b => b.classList.remove('active'));
            const mbBtn = document.getElementById('mb-' + t);
            if(mbBtn) mbBtn.classList.add('active');

            if(t === 'orders') renderOrders();
            if(t === 'add') renderAdd();
            if(t === 'team') renderTeam();
            if(t === 'fin') renderFin();
        }

        // 3. –°—Ç—Ä–∞–Ω–∏—Ü—ã
        function renderOrders() {
            const port = document.getElementById('view-port');
            const workCount = DB.orders.filter(o => o.status === 'work').length;
            const profit = DB.orders.filter(o => o.status === 'done').reduce((a, b) => a + Number(b.price), 0);

            port.innerHTML = `
                <div class="dashboard-stats">
                    <div class="stat-card"><small>–í —Ä–∞–±–æ—Ç–µ</small><b>${workCount}</b></div>
                    <div class="stat-card" style="border-color:var(--gold)"><small>–û–±—â–∞—è –∫–∞—Å—Å–∞</small><b class="gold-text">${profit} —Å</b></div>
                </div>
                <div class="orders-grid" id="order-list"></div>
            `;

            let list = DB.orders.filter(o => o.status !== 'archive').reverse();
            const grid = document.getElementById('order-list');

            if(list.length === 0) grid.innerHTML = '<p style="color:#222; text-align:center; padding:50px;">–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç...</p>';

            list.forEach(o => {
                let idx = DB.orders.indexOf(o);
                grid.innerHTML += `
                    <div class="order-card" style="${o.status==='rejected'?'opacity:0.4; border-color:var(--red)':''}">
                        <div class="price-badge">${o.price} —Å–æ–º</div>
                        <h3 style="margin:0;">${o.client}</h3>
                        <p style="color:var(--text-dim); font-size:0.85rem; margin:15px 0; flex:1;">${o.desc}</p>
                        ${o.ref ? `<div class="ref-area">üîó –†–µ—Ñ–µ—Ä–µ–Ω—Å—ã:<br>${o.ref}</div>` : ''}
                        <div class="status-badge st-${o.status}">${o.status}</div>
                        
                        <div style="margin-top:20px; display:flex; gap:10px;">
                            ${o.status === 'new' ? `<button onclick="update(${idx},'work')" class="btn btn-white" style="padding:10px;">–í–ó–Ø–¢–¨ –ó–ê–ö–ê–ó</button>` : ''}
                            ${o.status === 'work' ? `<button onclick="update(${idx},'done')" class="btn btn-white" style="background:var(--gold); padding:10px;">–ó–ê–í–ï–†–®–ò–¢–¨</button>` : ''}
                            ${['director','manager'].includes(me.role) ? `<button onclick="update(${idx},'rejected')" class="btn btn-outline" style="padding:5px; font-size:0.6rem; color:var(--red);">–û–¢–ö–ê–ó</button>` : ''}
                            ${me.role === 'director' ? `<button onclick="update(${idx},'archive')" class="btn btn-outline" style="padding:5px; font-size:0.5rem; border:none;">DEL</button>` : ''}
                        </div>
                    </div>
                `;
            });
        }

        function renderAdd() {
            if(me.role === 'programmer') return showMsg('–ù–ï–¢ –ü–†–ê–í –î–õ–Ø –°–û–ó–î–ê–ù–ò–Ø');
            document.getElementById('view-port').innerHTML = `
                <div style="max-width:600px; background:var(--card-bg); padding:30px; border-radius:30px; border:1px solid #222;">
                    <h2>–ù–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ M.C.</h2>
                    <input id="in-c" placeholder="–ò–º—è –∑–∞–∫–∞–∑—á–∏–∫–∞">
                    <input id="in-p" type="number" placeholder="–ë—é–¥–∂–µ—Ç (—Å–æ–º)">
                    <textarea id="in-d" placeholder="–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ" style="height:150px;"></textarea>
                    <textarea id="in-r" placeholder="–°—Å—ã–ª–∫–∏ –Ω–∞ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å—ã / –ø—Ä–∏–º–µ—Ä—ã" style="height:60px;"></textarea>
                    <input id="in-dt" type="date">
                    <button class="btn btn-white" onclick="saveOrder()">–û–ü–£–ë–õ–ò–ö–û–í–ê–¢–¨</button>
                </div>
            `;
        }

        function saveOrder() {
            const c = document.getElementById('in-c').value;
            const p = document.getElementById('in-p').value;
            const d = document.getElementById('in-d').value;
            const r = document.getElementById('in-r').value;
            const dt = document.getElementById('in-dt').value;
            if(!c || !p || !dt) return showMsg('–ó–ê–ü–û–õ–ù–ò–¢–ï –ö–õ–Æ–ß–ï–í–´–ï –ü–û–õ–Ø');
            DB.orders.push({ client: c, price: p, desc: d, ref: r, date: dt, status: 'new' });
            save(); 
            showMsg('–ó–ê–ö–ê–ó –£–°–ü–ï–®–ù–û –î–û–ë–ê–í–õ–ï–ù'); 
            tab('orders');
        }

        function renderTeam() {
            const port = document.getElementById('view-port');
            port.innerHTML = '<h2>–ö–æ–º–∞–Ω–¥–∞ Mistori Copani</h2> <div class="team-container" id="team-list"></div>';
            const grid = document.getElementById('team-list');

            let sorted = [...DB.users].sort((a,b) => (b.xp||0) - (a.xp||0));

            sorted.forEach(u => {
                let rank = u.xp >= 10 ? {n:'SENIOR', c:'rank-sen'} : (u.xp >= 3 ? {n:'MIDDLE', c:'rank-mid'} : {n:'JUNIOR', c:'rank-jun'});
                let dots = '';
                for(let i=1; i<=3; i++) dot
