<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M.C. SYSTEM | v30.0</title>
    <style>
        /* --- 1. –°–¢–ò–õ–ò (DESIGN) --- */
        :root {
            --bg: #000000;
            --card: #0f0f0f;
            --border: #222;
            --text: #fff;
            --gray: #888;
            --accent: #fff;
            --gold: #FFD700;
            --green: #00FF88;
            --red: #FF4444;
            --blue: #0088FF;
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; padding: 0; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* –í—Ö–æ–¥ */
        #auth-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 5000; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .auth-box { width: 100%; max-width: 350px; background: var(--card); border: 1px solid var(--border); padding: 40px 30px; border-radius: 20px; text-align: center; }
        .auth-title { font-size: 3rem; font-weight: 900; letter-spacing: 5px; margin: 0; }
        
        input, textarea { width: 100%; padding: 15px; margin: 10px 0; background: #1a1a1a; border: 1px solid #333; color: #fff; border-radius: 10px; font-size: 16px; }
        button { width: 100%; padding: 15px; border-radius: 10px; font-weight: bold; border: none; cursor: pointer; text-transform: uppercase; margin-top: 10px; font-size: 14px; }
        .btn-main { background: #fff; color: #000; }
        .btn-sec { background: transparent; color: #666; border: 1px solid #333; }
        .btn-danger { color: red; background: rgba(255,0,0,0.1); margin-top: 30px; font-size: 0.7rem; }

        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
        #app-screen { display: none; height: 100%; width: 100%; }
        
        /* –°–∞–π–¥–±–∞—Ä (–ü–ö) */
        .sidebar { width: 280px; background: #050505; border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 30px; }
        .nav-btn { background: transparent; color: #888; text-align: left; padding: 15px; margin-bottom: 5px; border-radius: 10px; transition: 0.2s; }
        .nav-btn.active, .nav-btn:hover { background: #151515; color: #fff; }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç */
        .main-content { flex: 1; display: flex; flex-direction: column; position: relative; }
        .top-bar { height: 70px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; padding: 0 20px; background: rgba(0,0,0,0.8); }
        .scroll-area { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; }

        /* –≠–ª–µ–º–µ–Ω—Ç—ã */
        .card { background: var(--card); border: 1px solid var(--border); padding: 20px; border-radius: 15px; margin-bottom: 15px; position: relative; }
        .price { position: absolute; top: 20px; right: 20px; color: var(--gold); border: 1px solid var(--gold); padding: 3px 8px; border-radius: 5px; font-weight: bold; }
        
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .stat-box { background: var(--card); border: 1px solid var(--border); padding: 15px; text-align: center; border-radius: 10px; }
        .stat-num { display: block; font-size: 1.5rem; font-weight: bold; margin-top: 5px; }

        /* –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é (–ú–æ–±–∏–ª—å–Ω–æ–µ) */
        .mobile-nav { display: none; position: fixed; bottom: 0; width: 100%; background: #080808; border-top: 1px solid var(--border); justify-content: space-around; padding: 10px 0; z-index: 1000; }
        .mob-btn { background: none; border: none; color: #555; font-size: 0.6rem; font-weight: bold; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .mob-btn.active { color: #fff; }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 900px) { .sidebar { display: none; } .mobile-nav { display: flex; } }

        /* –£—Ç–∏–ª–∏—Ç—ã */
        .hidden { display: none !important; }
        #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #fff; color: #000; padding: 10px 20px; border-radius: 30px; font-weight: bold; display: none; z-index: 9999; }
        
        .status-badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 0.6rem; text-transform: uppercase; border: 1px solid #333; margin-top: 10px; }
        .s-new { color: var(--green); border-color: var(--green); }
        .s-work { color: var(--blue); border-color: var(--blue); }
        .s-done { color: #fff; opacity: 0.5; }
    </style>
</head>
<body>

    <div id="toast">–°–æ–æ–±—â–µ–Ω–∏–µ</div>

    <div id="auth-screen">
        <div class="auth-box" id="login-box">
            <h1 class="auth-title">M.C.</h1>
            <p style="color:#666; letter-spacing:2px; font-size:0.7rem;">SYSTEM v30.0</p>
            <input type="text" id="ph" placeholder="–ù–æ–º–µ—Ä (705 163 333)">
            <input type="password" id="ps" placeholder="–ü–∞—Ä–æ–ª—å">
            <button class="btn-main" onclick="auth()">–í–û–ô–¢–ò</button>
            <button class="btn-sec" onclick="toggleReg(true)">–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</button>
            <button class="btn-danger" onclick="hardReset()">–°–ë–†–û–° –°–ò–°–¢–ï–ú–´</button>
        </div>

        <div class="auth-box hidden" id="reg-box">
            <h2>–ù–û–í–´–ô –°–û–¢–†–£–î–ù–ò–ö</h2>
            <input type="text" id="r-name" placeholder="–ò–º—è">
            <input type="text" id="r-ph" placeholder="–ù–æ–º–µ—Ä">
            <input type="password" id="r-ps" placeholder="–ü–∞—Ä–æ–ª—å">
            <button class="btn-main" onclick="reg()">–°–û–ó–î–ê–¢–¨</button>
            <button class="btn-sec" onclick="toggleReg(false)">–ù–ê–ó–ê–î</button>
        </div>
    </div>

    <div id="app-screen">
        <div class="sidebar">
            <h2 style="margin-bottom:40px; letter-spacing:3px;">MISTORI</h2>
            <button class="nav-btn active" id="d-orders" onclick="nav('orders')">üì¶ –ó–ê–ö–ê–ó–´</button>
            <button class="nav-btn" id="d-add" onclick="nav('add')">‚ûï –ù–û–í–´–ô</button>
            <button class="nav-btn" id="d-team" onclick="nav('team')">üë• –ö–û–ú–ê–ù–î–ê</button>
            <button class="nav-btn" id="d-fin" onclick="nav('fin')">üìä –ö–ê–°–°–ê</button>
            <button class="nav-btn" style="color:var(--red); margin-top:auto;" onclick="location.reload()">–í–´–•–û–î</button>
        </div>

        <div class="main-content">
            <div class="top-bar">
                <div>
                    <b id="u-name">Akjol</b> <br>
                    <small id="u-role" style="color:var(--green); font-size:0.6rem;">DIRECTOR</small>
                </div>
                <div style="font-weight:900; opacity:0.3;">M.C.</div>
            </div>

            <div class="scroll-area" id="view">
                </div>
        </div>

        <div class="mobile-nav">
            <button class="mob-btn active" id="m-orders" onclick="nav('orders')">üì¶<br>–ó–ê–ö–ê–ó–´</button>
            <button class="mob-btn" id="m-add" onclick="nav('add')">‚ûï<br>–ù–û–í–´–ô</button>
            <button class="mob-btn" id="m-team" onclick="nav('team')">üë•<br>–õ–Æ–î–ò</button>
            <button class="mob-btn" id="m-fin" onclick="nav('fin')">üìä<br>–ö–ê–°–°–ê</button>
        </div>
    </div>

    <script>
        // --- –ë–ê–ó–ê –î–ê–ù–ù–´–• (–ö–õ–Æ–ß–ï–í–û–ô –ú–û–ú–ï–ù–¢) ---
        const DB_KEY = 'mc_final_v30';
        let DB;
        let USER = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        try {
            const raw = localStorage.getItem(DB_KEY);
            if (raw) {
                DB = JSON.parse(raw);
            } else {
                initDB(); // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –µ—Å–ª–∏ –Ω–µ—Ç
            }
        } catch (e) {
            initDB(); // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é
        }

        function initDB() {
            DB = {
                users: [
                    { name: "–°–µ–∑–∏–º", phone: "777800603", pass: "admin2", role: "manager", xp: 5, warns: 0 }
                ],
                orders: []
            };
            save();
        }

        // --- –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ---
        function auth() {
            const p = document.getElementById('ph').value.trim();
            const s = document.getElementById('ps').value.trim();

            if (p === '705163333' && s === 'admin123') {
                USER = { name: "–ê–∫–∂–æ–ª", phone: p, role: "director", xp: 999 };
                start();
            } else {
                let u = DB.users.find(x => x.phone === p && x.pass === s);
                if (u) { USER = u; start(); } else { msg('–ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ'); }
            }
        }

        function reg() {
            const n = document.getElementById('r-name').value;
            const p = document.getElementById('r-ph').value;
            const s = document.getElementById('r-ps').value;
            
            if(!n || !p || !s) return msg('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
            if(DB.users.find(u => u.phone === p) || p === '705163333') return msg('–ù–æ–º–µ—Ä –∑–∞–Ω—è—Ç');

            DB.users.push({ name: n, phone: p, pass: s, role: "programmer", xp: 0, warns: 0 });
            save();
            msg('–£—Å–ø–µ—à–Ω–æ! –í–æ–π–¥–∏—Ç–µ.');
            toggleReg(false);
        }

        function start() {
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('app-screen').style.display = 'flex';
            document.getElementById('u-name').innerText = USER.name;
            document.getElementById('u-role').innerText = USER.role.toUpperCase();
            nav('orders');
        }

        // --- –ù–ê–í–ò–ì–ê–¶–ò–Ø ---
        function nav(tab) {
            const view = document.getElementById('view');
            // –°–±—Ä–æ—Å –∫–ª–∞—Å—Å–æ–≤ –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.nav-btn, .mob-btn').forEach(b => b.classList.remove('active'));
            if(document.getElementById('d-'+tab)) document.getElementById('d-'+tab).classList.add('active');
            if(document.getElementById('m-'+tab)) document.getElementById('m-'+tab).classList.add('active');

            if(tab === 'orders') renderOrders(view);
            if(tab === 'add') renderAdd(view);
            if(tab === 'team') renderTeam(view);
            if(tab === 'fin') renderFin(view);
        }

        // --- –≠–ö–†–ê–ù 1: –ó–ê–ö–ê–ó–´ ---
        function renderOrders(el) {
            const active = DB.orders.filter(o => o.status === 'work').length;
            const profit = DB.orders.filter(o => o.status === 'done').reduce((a,b) => a + Number(b.price), 0);

            let html = `
                <div class="stat-grid">
                    <div class="stat-box"><small>–í –†–ê–ë–û–¢–ï</small><span class="stat-num">${active}</span></div>
                    <div class="stat-box" style="border-color:var(--gold)"><small>–ü–†–ò–ë–´–õ–¨</small><span class="stat-num" style="color:var(--gold)">${profit} —Å</span></div>
                </div>
                <h3>–ê–ö–¢–ò–í–ù–´–ï –ü–†–û–ï–ö–¢–´</h3>
            `;

            let list = DB.orders.filter(o => o.status !== 'archive').reverse();
            if(list.length === 0) html += `<p style="text-align:center; color:#444; margin-top:50px;">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</p>`;

            list.forEach(o => {
                let idx = DB.orders.indexOf(o);
                html += `
                    <div class="card" style="${o.status==='reject' ? 'opacity:0.5; border-color:red' : ''}">
                        <div class="price">${o.price} —Å</div>
                        <h3>${o.client}</h3>
                        <p style="color:#aaa; font-size:0.9rem;">${o.desc}</p>
                        ${o.ref ? `<div style="padding:10px; background:#111; margin:10px 0; border-radius:5px; font-size:0.8rem; color:var(--blue);">üîó ${o.ref}</div>` : ''}
                        
                        <div class="status-badge s-${o.status}">${o.status}</div>
                        
                        <div style="margin-top:15px; display:flex; gap:10px;">
                            ${o.status === 'new' ? `<button onclick="setStatus(${idx},'work')" class="btn-main" style="padding:10px; width:auto; border-radius:8px;">–í–ó–Ø–¢–¨</button>` : ''}
                            ${o.status === 'work' ? `<button onclick="setStatus(${idx},'done')" class="btn-main" style="background:var(--gold); padding:10px; width:auto; border-radius:8px;">–ì–û–¢–û–í–û</button>` : ''}
                            ${['director','manager'].includes(USER.role) ? `<button onclick="setStatus(${idx},'reject')" style="background:none; border:1px solid red; color:red; padding:10px; border-radius:8px;">–û–¢–ö–ê–ó</button>` : ''}
                            ${USER.role === 'director' ? `<button onclick="setStatus(${idx},'archive')" style="background:none; color:#444; border:none;">DEL</button>` : ''}
                        </div>
                    </div>
                `;
            });
            el.innerHTML = html;
        }

        // --- –≠–ö–†–ê–ù 2: –ù–û–í–´–ô ---
        function renderAdd(el) {
            if(USER.role === 'programmer') {
                el.innerHTML = '<h3 style="text-align:center; margin-top:50px; color:#444;">–ù–ï–¢ –î–û–°–¢–£–ü–ê</h3>';
                return;
            }
            el.innerHTML = `
                <h3>–ù–û–í–´–ô –ó–ê–ö–ê–ó</h3>
                <div class="card">
                    <input id="in-c" placeholder="–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞">
                    <input id="in-p" type="number" placeholder="–¶–µ–Ω–∞ (—Å–æ–º)">
                    <textarea id="in-d" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ / –¢–ó" style="height:100px;"></textarea>
                    <textarea id="in-r" placeholder="–°—Å—ã–ª–∫–∏ –Ω–∞ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å—ã" style="height:60px;"></textarea>
                    <button class="btn-main" onclick="addOrder()">–û–ü–£–ë–õ–ò–ö–û–í–ê–¢–¨</button>
                </div>
            `;
        }

        function addOrder() {
            const c = document.getElementById('in-c').value;
            const p = document.getElementById('in-p').value;
            const d = document.getElementById('in-d').value;
            const r = document.getElementById('in-r').value;
            if(!c || !p) return msg('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è!');
            
            DB.orders.push({ client: c, price: p, desc: d, ref: r, status: 'new', date: new Date().toLocaleDateString() });
            save(); msg('–°–æ–∑–¥–∞–Ω–æ!'); nav('orders');
        }

        // --- –≠–ö–†–ê–ù 3: –ö–û–ú–ê–ù–î–ê ---
        function renderTeam(el) {
            el.innerHTML = '<h3>–ö–û–ú–ê–ù–î–ê M.C.</h3>';
            DB.users.forEach(u => {
                let dots = '';
                for(let i=1; i<=3; i++) dots += `<span style="display:inline-block; width:10px; height:10px; background:${u.warns>=i?'red':'#333'}; border-radius:50%; margin-right:5px;"></span>`;
                
                el.innerHTML += `
                    <div class="card" style="display:flex; align-items:center; gap:15px;">
                        <div style="width:50px; height:50px; background:#1a1a1a; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold;">${u.name[0]}</div>
                        <div style="flex:1;">
                            <b>${u.name}</b> <small style="color:#666">(${u.role})</small><br>
                            <small>XP: ${u.xp}</small>
                            <div style="margin-top:5px;">${dots}</div>
                        </div>
                        ${USER.role === 'director' && u.phone !== USER.phone ? `
                            <button onclick="warn('${u.phone}')" style="background:red; color:#fff; border:none; padding:5px 10px; border-radius:5px; font-size:0.6rem;">–í–´–ì–û–í–û–†</button>
                        ` : ''}
                    </div>
                `;
            });
        }

        function warn(ph) {
            let u = DB.users.find(x => x.phone === ph);
            if(u) { u.warns++; save(); renderTeam(document.getElementById('view')); msg('–í—ã–≥–æ–≤–æ—Ä!'); }
        }

        // --- –≠–ö–†–ê–ù 4: –ö–ê–°–°–ê ---
        function renderFin(el) {
            const total = DB.orders.filter(o => o.status === 'done').reduce((a,b) => a + Number(b.price), 0);
            el.innerHTML = `
                <div style="text-align:center; padding-top:50px;">
                    <small>–û–ë–©–ò–ô –î–û–•–û–î</small>
                    <div style="font-size:3rem; font-weight:900; color:var(--gold); margin:20px 0;">${total} —Å–æ–º</div>
                    <p style="color:#444; font-size:0.8rem;">–£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–∞–∫—Ä—ã—Ç—ã–µ –∑–∞–∫–∞–∑—ã</p>
                </div>
            `;
        }

        // --- –£–¢–ò–õ–ò–¢–´ ---
        function setStatus(i, st) {
            DB.orders[i].status = st;
            if(st === 'done') {
                // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ XP (–ø—Ä–æ—Å—Ç–æ–µ)
                let meDb = DB.users.find(u => u.phone === USER.phone);
                if(meDb) meDb.xp++;
            }
            save(); nav('orders');
        }

        function save() { localStorage.setItem(DB_KEY, JSON.stringify(DB)); }
        
        function msg(text) {
            const t = document.getElementById('toast');
            t.innerText = text; t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 2000);
        }

        function toggleReg(show) {
            document.getElementById('login-box').classList.toggle('hidden', show);
            document.getElementById('reg-box').classList.toggle('hidden', !show);
        }

        function hardReset() {
            if(confirm('–≠–¢–û –£–î–ê–õ–ò–¢ –í–°–Æ –ë–ê–ó–£ –î–ê–ù–ù–´–•. –ü–†–û–î–û–õ–ñ–ò–¢–¨?')) {
                localStorage.removeItem(DB_KEY);
                location.reload();
            }
        }

    </script>
</body>
</html>
