<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.A.B. CONTROL</title>
    <style>
        /* --- –î–ò–ó–ê–ô–ù (–°–¢–ò–õ–ò) --- */
        body { background-color: #000000; color: #ffffff; font-family: sans-serif; margin: 0; height: 100vh; display: flex; flex-direction: column; }
        
        /* –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ */
        .login-box { width: 300px; margin: 100px auto; border: 1px solid white; padding: 30px; text-align: center; }
        input { width: 90%; background: #000; border: 1px solid #fff; color: #fff; padding: 10px; margin: 10px 0; }
        button { cursor: pointer; padding: 10px; text-transform: uppercase; font-weight: bold; transition: 0.2s; }
        .btn-white { background: white; color: black; border: none; width: 100%; }
        .btn-outline { background: transparent; color: white; border: 1px solid white; width: 100%; }
        
        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞ */
        #app { display: none; height: 100%; }
        .sidebar { width: 250px; border-right: 1px solid white; padding: 20px; background: #111; display: flex; flex-direction: column; gap: 15px; }
        .content { flex: 1; padding: 20px; overflow-y: auto; }
        
        /* –ú–µ–Ω—é –∏ –ö–Ω–æ–ø–∫–∏ */
        .menu-btn { background: transparent; color: white; border: 1px solid #444; text-align: left; width: 100%; margin-bottom: 5px; }
        .menu-btn:hover { background: #333; }
        .menu-active { border-color: #00ff00; color: #00ff00; }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .stat-row { display: flex; gap: 10px; margin-bottom: 20px; }
        .stat-card { border: 1px solid white; padding: 15px; flex: 1; text-align: center; }
        .stat-num { font-size: 1.5rem; font-weight: bold; display: block; }
        
        .order-card { border: 1px solid #555; padding: 15px; margin-bottom: 10px; background: #050505; }
        .status-free { color: #00ff00; }
        .status-work { color: yellow; }
        .status-closed { color: red; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h1>S.A.B. SYSTEM</h1>
            <p>–í–•–û–î –í –°–ò–°–¢–ï–ú–£</p>
            <input type="text" id="ph" placeholder="–ù–æ–º–µ—Ä (705163333)">
            <input type="password" id="ps" placeholder="–ü–∞—Ä–æ–ª—å">
            <button class="btn-white" onclick="tryLogin()">–í–û–ô–¢–ò</button>
            <br><br>
            <small>–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?</small>
            <button class="btn-outline" onclick="showReg()">–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</button>
        </div>
    </div>

    <div id="reg-screen" style="display:none;">
        <div class="login-box">
            <h2>–ù–û–í–´–ô –°–û–¢–†–£–î–ù–ò–ö</h2>
            <input type="text" id="r-name" placeholder="–ò–º—è">
            <input type="text" id="r-phone" placeholder="–ù–æ–º–µ—Ä">
            <input type="password" id="r-pass" placeholder="–ü–∞—Ä–æ–ª—å">
            <button class="btn-white" onclick="doReg()">–°–û–ó–î–ê–¢–¨ –ê–ö–ö–ê–£–ù–¢</button>
            <br><br>
            <button class="btn-outline" onclick="location.reload()">–ù–ê–ó–ê–î</button>
        </div>
    </div>

    <div id="app">
        <div class="sidebar">
            <h2 id="user-name">NAME</h2>
            <p id="user-role" style="color:gray; margin-top:-15px;">ROLE</p>
            <hr style="border:0.5px solid #333; width:100%;">
            
            <button class="menu-btn" onclick="renderOrders()">üìÅ –í–°–ï –ó–ê–ö–ê–ó–´</button>
            <button class="menu-btn" onclick="renderStaff()">üë• –°–û–¢–†–£–î–ù–ò–ö–ò</button>
            <button class="menu-btn" id="btn-add" style="display:none; border-color:#00ff00;" onclick="renderAddOrder()">+ –ù–û–í–´–ô –ó–ê–ö–ê–ó</button>
            
            <button class="menu-btn" style="margin-top:auto; border-color:red; color:red;" onclick="logout()">–í–´–•–û–î</button>
        </div>
        
        <div class="content">
            <div class="stat-row">
                <div class="stat-card">–°–í–û–ë–û–î–ù–û <span class="stat-num" id="c-free">0</span></div>
                <div class="stat-card">–í –†–ê–ë–û–¢–ï <span class="stat-num" id="c-work">0</span></div>
                <div class="stat-card">–ó–ê–ö–†–´–¢–û <span class="stat-num" id="c-closed">0</span></div>
            </div>

            <div id="main-view"></div>
        </div>
    </div>

    <script>
        /* --- –õ–û–ì–ò–ö–ê (JAVASCRIPT) --- */
        
        // 1. –ë–ê–ó–ê –î–ê–ù–ù–´–• (–ó–∞–≥—Ä—É–∂–∞–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –ø—É—Å—Ç—É—é)
        let DB = JSON.parse(localStorage.getItem('sab_db')) || { 
            users: [], 
            orders: [] 
        };

        let currentUser = null;

        // 2. –í–•–û–î
        function tryLogin() {
            const ph = document.getElementById('ph').value.trim();
            const ps = document.getElementById('ps').value.trim();

            // –°–ü–ï–¶–ò–ê–õ–¨–ù–´–ô –í–•–û–î –î–õ–Ø –î–ò–†–ï–ö–¢–û–†–ê
            if (ph === '705163333' && ps === 'admin123') {
                currentUser = { name: '–°.–ê.–ë', role: 'director', phone: '705163333' };
                enterApp();
                return;
            }

            // –ü–æ–∏—Å–∫ –≤ –±–∞–∑–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
            let found = DB.users.find(u => u.phone === ph && u.pass === ps);
            if (found) {
                currentUser = found;
                enterApp();
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä –∏–ª–∏ –ø–∞—Ä–æ–ª—å!');
            }
        }

        // 3. –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø
        function showReg() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('reg-screen').style.display = 'block';
        }

        function doReg() {
            const name = document.getElementById('r-name').value;
            const phone = document.getElementById('r-phone').value;
            const pass = document.getElementById('r-pass').value;

            if (phone === '705163333' || DB.users.find(u => u.phone === phone)) {
                alert('–≠—Ç–æ—Ç –Ω–æ–º–µ—Ä —É–∂–µ –∑–∞–Ω—è—Ç!');
                return;
            }
            
            DB.users.push({ name, phone, pass, role: 'programmer' });
            saveDB();
            alert('–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏—Ç–µ.');
            location.reload();
        }

        // 4. –ó–ê–ü–£–°–ö –ò–ù–¢–ï–†–§–ï–ô–°–ê
        function enterApp() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app').style.display = 'flex';
            
            document.getElementById('user-name').innerText = currentUser.name;
            document.getElementById('user-role').innerText = currentUser.role.toUpperCase();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑" —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª—å—Å—Ç–≤—É
            if (currentUser.role === 'director' || currentUser.role === 'manager') {
                document.getElementById('btn-add').style.display = 'block';
            }

            updateStats();
            renderOrders(); // –°—Ä–∞–∑—É –æ—Ç–∫—Ä—ã–≤–∞–µ–º –∑–∞–∫–∞–∑—ã
        }

        // 5. –†–ê–ë–û–¢–ê –° –ó–ê–ö–ê–ó–ê–ú–ò
        function renderOrders() {
            const view = document.getElementById('main-view');
            view.innerHTML = '<h2>–°–ü–ò–°–û–ö –ó–ê–ö–ê–ó–û–í</h2>';

            if (DB.orders.length === 0) {
                view.innerHTML += '<p style="color:gray">–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>';
                return;
            }

            DB.orders.forEach((ord, idx) => {
                let actionBtn = '';
                if (ord.status === 'free') {
                    actionBtn = `<button style="background:#00ff00; color:black; border:none; margin-top:10px;" onclick="setStatus(${idx}, 'process')">–í–ó–Ø–¢–¨ –í –†–ê–ë–û–¢–£</button>`;
                } else if (ord.status === 'process' && currentUser.role === 'programmer') { // –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç —Å–¥–∞–µ—Ç
                     actionBtn = `<button style="background:yellow; color:black; border:none; margin-top:10px;" onclick="setStatus(${idx}, 'closed')">–°–î–ê–¢–¨ –ó–ê–ö–ê–ó</button>`;
                }

                view.innerHTML += `
                    <div class="order-card">
                        <div style="display:flex; justify-content:space-between;">
                            <strong>${ord.client}</strong>
                            <small>${ord.date}</small>
                        </div>
                        <p>${ord.desc}</p>
                        <p style="color: #888;">–°—Ç–∞—Ç—É—Å: <b class="${getStatusColor(ord.status)}">${ord.status.toUpperCase()}</b></p>
                        ${actionBtn}
                    </div>
                `;
            });
        }

        function renderAddOrder() {
            const view = document.getElementById('main-view');
            view.innerHTML = `
                <h2>–°–û–ó–î–ê–ù–ò–ï –ó–ê–ö–ê–ó–ê</h2>
                <input id="new-client" placeholder="–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞">
                <input id="new-phone" placeholder="–ù–æ–º–µ—Ä –∫–ª–∏–µ–Ω—Ç–∞">
                <textarea id="new-desc" placeholder="–¢–ó, –æ–ø–∏—Å–∞–Ω–∏–µ, —Å—Å—ã–ª–∫–∏..." style="width:100%; height:100px; background:black; color:white; border:1px solid white;"></textarea>
                <input type="date" id="new-date" style="background:white; color:black;">
                <button class="btn-white" style="margin-top:10px;" onclick="addOrder()">–î–û–ë–ê–í–ò–¢–¨ –í –ë–ê–ó–£</button>
            `;
        }

        function addOrder() {
            const client = document.getElementById('new-client').value;
            const desc = document.getElementById('new-desc').value;
            const date = document.getElementById('new-date').value;

            DB.orders.push({
                client, desc, date, 
                status: 'free', // free, process, closed
                worker: null
            });
            saveDB();
            updateStats();
            alert('–ó–∞–∫–∞–∑ –¥–æ–±–∞–≤–ª–µ–Ω!');
            renderOrders();
        }

        function setStatus(idx, status) {
            DB.orders[idx].status = status;
            if (status === 'process') DB.orders[idx].worker = currentUser.name;
            saveDB();
            updateStats();
            renderOrders();
        }

        // 6. –°–û–¢–†–£–î–ù–ò–ö–ò
        function renderStaff() {
            const view = document.getElementById('main-view');
            view.innerHTML = '<h2>–ù–ê–®–ò –°–û–¢–†–£–î–ù–ò–ö–ò</h2>';
            
            DB.users.forEach((u, idx) => {
                view.innerHTML += `
                    <div class="order-card">
                        <h3>${u.name}</h3>
                        <p>${u.role}</p>
                        <p>${u.phone}</p>
                        ${currentUser.role === 'director' ? `<button style="color:red; border:1px solid red; background:transparent;" onclick="fireUser(${idx})">–£–í–û–õ–ò–¢–¨</button>` : ''}
                    </div>
                `;
            });
        }

        function fireUser(idx) {
            if(confirm('–¢–æ—á–Ω–æ —É–≤–æ–ª–∏—Ç—å?')) {
                DB.users.splice(idx, 1);
                saveDB();
                renderStaff();
            }
        }

        // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
        function saveDB() {
            localStorage.setItem('sab_db', JSON.stringify(DB));
        }

        function updateStats() {
            document.getElementById('c-free').innerText = DB.orders.filter(o => o.status === 'free').length;
            document.getElementById('c-work').innerText = DB.orders.filter(o => o.status === 'process').length;
            document.getElementById('c-closed').innerText = DB.orders.filter(o => o.status === 'closed').length;
        }

        function getStatusColor(s) {
            if (s === 'free') return 'status-free';
            if (s === 'process') return 'status-work';
            return 'status-closed';
        }

        function logout() {
            location.reload();
        }
    </script>
</body>
</html>
