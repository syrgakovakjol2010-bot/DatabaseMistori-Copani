<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M.C. CHAT | BOSS TERMINAL</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        /* --- –°–¢–ò–õ–ò –ò –ü–ï–†–ï–ú–ï–ù–ù–´–ï --- */
        :root {
            --bg: #000000;
            --card: #0a0a0a;
            --border: #1a1a1a;
            --text: #ffffff;
            --text-dim: #666666;
            --gold: #ffd700;
            --green: #00ff66;
            --red: #ff3333;
            --blue: #0088ff;
            --purple: #bf00ff;
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; margin: 0; padding: 0; overflow: hidden; height: 100vh; }

        /* --- –í–•–û–î --- */
        #auth-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            background: var(--bg); z-index: 5000;
        }
        .auth-card {
            width: 90%; max-width: 380px; background: var(--card);
            border: 1px solid var(--border); padding: 40px; border-radius: 30px;
            text-align: center; box-shadow: 0 20px 80px rgba(0,0,0,0.8);
        }
        .auth-card h1 { font-size: 3rem; letter-spacing: 10px; margin: 0; font-weight: 900; }
        
        input, textarea {
            width: 100%; padding: 16px; margin: 10px 0; background: #111;
            border: 1px solid #222; color: #fff; border-radius: 15px; font-size: 16px;
        }
        .btn {
            width: 100%; padding: 16px; border-radius: 15px; font-weight: 800;
            border: none; cursor: pointer; text-transform: uppercase; transition: 0.3s;
        }
        .btn-white { background: #fff; color: #000; }
        .btn-out { background: transparent; color: var(--text-dim); border: 1px solid #222; margin-top: 15px; }

        /* --- –ì–õ–ê–í–ù–´–ô –ò–ù–¢–ï–†–§–ï–ô–° --- */
        #app { display: none; height: 100vh; width: 100vw; flex-direction: row; }

        /* Sidebar (–ü–ö) */
        .sidebar {
            width: 280px; background: #050505; border-right: 1px solid var(--border);
            display: flex; flex-direction: column; padding: 30px; z-index: 100;
        }
        .nav-list { flex: 1; display: flex; flex-direction: column; gap: 8px; }
        .nav-item {
            background: transparent; border: none; color: var(--text-dim);
            padding: 14px 18px; border-radius: 12px; text-align: left;
            cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 12px;
        }
        .nav-item.active { background: #111; color: #fff; border-left: 4px solid #fff; }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç */
        .main-wrapper { flex: 1; display: flex; flex-direction: column; height: 100vh; position: relative; }
        .top-bar {
            padding: 15px 25px; display: flex; justify-content: space-between;
            align-items: center; background: rgba(0,0,0,0.6); backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
        }
        .view-port { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 120px; }

        /* --- –ß–ê–¢ –°–¢–ò–õ–ò --- */
        .chat-container { display: flex; flex-direction: column; height: 100%; max-width: 800px; margin: 0 auto; }
        .chat-messages { flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 12px; }
        
        .msg { max-width: 80%; padding: 12px 16px; border-radius: 18px; position: relative; font-size: 0.95rem; line-height: 1.4; }
        .msg-own { align-self: flex-end; background: #fff; color: #000; border-bottom-right-radius: 4px; }
        .msg-other { align-self: flex-start; background: #1a1a1a; color: #fff; border-bottom-left-radius: 4px; border: 1px solid #333; }
        
        .msg-info { font-size: 0.65rem; margin-bottom: 4px; opacity: 0.6; display: flex; justify-content: space-between; }
        .msg-text { word-wrap: break-word; }
        
        .chat-input-area { display: flex; gap: 10px; padding: 15px; border-top: 1px solid var(--border); background: #000; }
        .chat-input { flex: 1; margin: 0 !important; }
        .send-btn { width: 60px !important; background: var(--blue); color: #fff; border: none; border-radius: 15px; cursor: pointer; }

        /* --- –ö–ê–†–¢–û–ß–ö–ò –ò –¢–ê–ë–õ–ò–¶–´ --- */
        .stat-card { background: var(--card); border: 1px solid var(--border); padding: 20px; border-radius: 20px; }
        .order-card { background: var(--card); border: 1px solid var(--border); padding: 20px; border-radius: 25px; margin-bottom: 15px; position: relative; }
        .price-badge { position: absolute; top: 20px; right: 20px; color: var(--gold); font-weight: 900; border: 1px solid var(--gold); padding: 4px 8px; border-radius: 8px; font-size: 0.8rem; }
        
        .warn-dot { width: 8px; height: 8px; background: #222; border-radius: 50%; display: inline-block; margin-right: 4px; }
        .warn-red { background: var(--red); box-shadow: 0 0 8px var(--red); }

        /* --- MOBILE NAV --- */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; height: 75px;
            background: rgba(5,5,5,0.95); backdrop-filter: blur(15px);
            border-top: 1px solid var(--border); display: none;
            justify-content: space-around; align-items: center; padding-bottom: 15px; z-index: 1000;
        }
        .nav-btn-mob { background: none; border: none; color: #444; font-size: 0.6rem; display: flex; flex-direction: column; align-items: center; gap: 5px; font-weight: bold; }
        .nav-btn-mob.active { color: #fff; }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .bottom-nav { display: flex; }
            .top-bar { padding: 10px 15px; }
            .view-port { padding: 15px; }
        }

        #toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background: #fff; color: #000; padding: 12px 30px; border-radius: 50px;
            font-weight: 900; display: none; z-index: 10000; font-size: 0.8rem;
        }
    </style>
</head>
<body>

    <div id="toast"></div>

    <div id="auth-screen">
        <div class="auth-card" id="login-box">
            <h1>M.C.</h1>
            <p>MISTORI COPANI BOSS v19</p>
            <input type="text" id="l-phone" placeholder="–ù–æ–º–µ—Ä (705 163 333)">
            <input type="password" id="l-pass" placeholder="–ü–∞—Ä–æ–ª—å">
            <button class="btn btn-white" onclick="tryLogin()">–í–û–ô–¢–ò</button>
            <button class="btn btn-out" onclick="toggleReg(true)">–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</button>
            <p onclick="fullReset()" style="margin-top:25px; font-size:0.5rem; color:#222; cursor:pointer;">–°–ë–†–û–°–ò–¢–¨ –ë–ê–ó–£ –î–ê–ù–ù–´–•</p>
        </div>
        
        <div class="auth-card" id="reg-box" style="display:none;">
            <h2>–ù–û–í–´–ô ID</h2>
            <input type="text" id="r-name" placeholder="–ò–º—è">
            <input type="text" id="r-phone" placeholder="–ù–æ–º–µ—Ä">
            <input type="password" id="r-pass" placeholder="–ü–∞—Ä–æ–ª—å">
            <button class="btn btn-white" onclick="tryReg()">–°–û–ó–î–ê–¢–¨</button>
            <button class="btn btn-out" onclick="toggleReg(false)">–ù–ê–ó–ê–î</button>
        </div>
    </div>

    <div id="app">
        <div class="sidebar">
            <div style="font-size:1.5rem; font-weight:900; letter-spacing:4px; margin-bottom:40px;">MISTORI</div>
            <div class="nav-list">
                <button class="nav-item active" id="pc-orders" onclick="tab('orders')">üíº –ó–ê–ö–ê–ó–´</button>
                <button class="nav-item" id="pc-chat" onclick="tab('chat')">üí¨ –ß–ê–¢ –°–¢–£–î–ò–ò</button>
                <button class="nav-item" id="pc-team" onclick="tab('team')">üë• –ö–û–ú–ê–ù–î–ê</button>
                <button class="nav-item" id="pc-add" onclick="tab('add')">‚ûï –ù–û–í–´–ô –ü–†–û–ï–ö–¢</button>
                <button class="nav-item" id="pc-fin" onclick="tab('fin')">üìä –ö–ê–°–°–ê</button>
            </div>
            <button class="nav-item" onclick="location.reload()" style="color:var(--red); margin-top:20px;">–í–´–•–û–î</button>
        </div>

        <div class="main-wrapper">
            <div class="top-bar">
                <div style="display:flex; align-items:center; gap:12px;">
                    <div id="me-ava" style="width:35px; height:35px; background:#111; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; border:1px solid #333;">A</div>
                    <div>
                        <b id="me-name">Akjol</b> <br>
                        <small id="me-role" style="color:var(--green); font-size:0.6rem; text-transform:uppercase;"></small>
                    </div>
                </div>
                <div style="font-weight:900; opacity:0.2; font-size:0.7rem; letter-spacing:2px;">MISTORI COPANI</div>
            </div>

            <div class="view-port" id="view-port">
                </div>

            <div class="bottom-nav">
                <button class="nav-btn-mob active" id="mb-orders" onclick="tab('orders')">üì¶<br>–ü–†–û–ï–ö–¢–´</button>
                <button class="nav-btn-mob" id="mb-chat" onclick="tab('chat')">üí¨<br>–ß–ê–¢</button>
                <button class="nav-btn-mob" id="mb-team" onclick="tab('team')">üë•<br>–ö–û–ú–ê–ù–î–ê</button>
                <button class="nav-btn-mob" id="mb-add" onclick="tab('add')">‚ûï<br>–ù–û–í–´–ô</button>
                <button class="nav-btn-mob" id="mb-fin" onclick="tab('fin')">üìä<br>–ö–ê–°–°–ê</button>
            </div>
        </div>
    </div>

    <script>
        /* --- CORE LOGIC --- */

        let DB = JSON.parse(localStorage.getItem('mc_v19_chat')) || {
            users: [
                { name: "–°–µ–∑–∏–º", phone: "777800603", pass: "admin2", role: "manager", xp: 5, warns: 0 }
            ],
            orders: [],
            messages: [
                { user: "–°–∏—Å—Ç–µ–º–∞", text: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —á–∞—Ç Mistori Copani!", time: "00:00", role: "system" }
            ]
        };

        let me = null;

        function tryLogin() {
            const ph = document.getElementById('l-phone').value.trim();
            const ps = document.getElementById('l-pass').value.trim();

            if (ph === '705163333' && ps === 'admin123') {
                me = { name: "–ê–∫–∂–æ–ª", phone: ph, role: "director", xp: 999 };
                enterApp();
            } else {
                let u = DB.users.find(x => x.phone === ph && x.pass === ps);
                if (u) { me = u; enterApp(); } else { notify('–û–®–ò–ë–ö–ê –î–û–°–¢–£–ü–ê'); }
            }
        }

        function tryReg() {
            const n = document.getElementById('r-name').value;
            const p = document.getElementById('r-phone').value;
            const ps = document.getElementById('r-pass').value;
            if(!n || !p || !ps) return notify('–ó–ê–ü–û–õ–ù–ò–¢–ï –í–°–Å');
            if(DB.users.find(x => x.phone === p) || p === '705163333') return notify('–ù–û–ú–ï–† –ó–ê–ù–Ø–¢');

            DB.users.push({ name: n, phone: p, pass: ps, role: "programmer", xp: 0, warns: 0 });
            save(); notify('ID –°–û–ó–î–ê–ù!'); location.reload();
        }

        function enterApp() {
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('app').style.display = 'flex';
            document.getElementById('me-name').innerText = me.name;
            document.getElementById('me-role').innerText = me.role;
            document.getElementById('me-ava').innerText = me.name[0];
            tab('orders');
        }

        function tab(t) {
            const port = document.getElementById('view-port');
            document.querySelectorAll('.nav-item, .nav-btn-mob').forEach(b => b.classList.remove('active'));
            if(document.getElementById('pc-'+t)) document.getElementById('pc-'+t).classList.add('active');
            if(document.getElementById('mb-'+t)) document.getElementById('mb-'+t).classList.add('active');

            if(t === 'orders') renderOrders();
            if(t === 'chat') renderChat();
            if(t === 'team') renderTeam();
            if(t === 'add') renderAdd();
            if(t === 'fin') renderFin();
        }

        // --- –°–¢–†–ê–ù–ò–¶–ê –ó–ê–ö–ê–ó–û–í ---
        function renderOrders() {
            const port = document.getElementById('view-port');
            port.innerHTML = `<h3>–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã</h3><div id="order-list"></div>`;
            const list = document.getElementById('order-list');

            DB.orders.filter(o => o.status !== 'archive').reverse().forEach((o, i) => {
                let idx = DB.orders.indexOf(o);
                list.innerHTML += `
                    <div class="order-card">
                        <div class="price-badge">${o.price} —Å</div>
                        <b>${o.client}</b>
                        <p style="color:var(--text-dim); font-size:0.8rem; margin:10px 0;">${o.desc}</p>
                        <div style="margin-top:15px; display:flex; gap:8px;">
                            ${o.status === 'new' ? `<button onclick="updSt(${idx},'work')" class="btn btn-white" style="padding:8px; width:auto;">–í–ó–Ø–¢–¨</button>` : ''}
                            ${o.status === 'work' ? `<button onclick="updSt(${idx},'done')" class="btn btn-white" style="background:var(--gold); padding:8px; width:auto;">–ì–û–¢–û–í–û</button>` : ''}
                            ${me.role === 'director' ? `<button onclick="updSt(${idx},'archive')" style="background:none; border:none; color:red; font-size:0.6rem;">–£–î–ê–õ–ò–¢–¨</button>` : ''}
                        </div>
                    </div>
                `;
            });
        }

        // --- –°–ò–°–¢–ï–ú–ê –ß–ê–¢–ê ---
        function renderChat() {
            const port = document.getElementById('view-port');
            port.innerHTML = `
                <div class="chat-container">
                    <div class="chat-messages" id="chat-msgs"></div>
                    <div class="chat-input-area">
                        <input type="text" id="chat-inp" class="chat-input" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ...">
                        <button class="send-btn" onclick="sendMsg()">></button>
                    </div>
                </div>
            `;
            updateChat();
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ Enter
            document.getElementById('chat-inp').addEventListener('keypress', (e) => {
                if(e.key === 'Enter') sendMsg();
            });
        }

        function updateChat() {
            const box = document.getElementById('chat-msgs');
            if(!box) return;
            box.innerHTML = '';
            DB.messages.forEach((m, i) => {
                const isMe = m.user === me.name;
                box.innerHTML += `
                    <div class="msg ${isMe ? 'msg-own' : 'msg-other'}">
                        <div class="msg-info">
                            <span>${m.user} (${m.role})</span>
                            <span>${m.time}</span>
                        </div>
                        <div class="msg-text">${m.text}</div>
                        ${me.role === 'director' ? `<div onclick="delMsg(${i})" style="font-size:0.5rem; color:red; cursor:pointer; margin-top:5px;">–£–¥–∞–ª–∏—Ç—å</div>` : ''}
                    </div>
                `;
            });
            box.scrollTop = box.scrollHeight;
        }

        function sendMsg() {
            const inp = document.getElementById('chat-inp');
            if(!inp.value.trim()) return;
            const now = new Date();
            const time = now.getHours() + ":" + (now.getMinutes()<10?'0':'') + now.getMinutes();
            
            DB.messages.push({
                user: me.name,
                text: inp.value,
                time: time,
                role: me.role
            });
            inp.value = '';
            save();
            updateChat();
        }

        function delMsg(i) {
            DB.messages.splice(i, 1);
            save();
            updateChat();
        }

        // --- –ö–û–ú–ê–ù–î–ê ---
        function renderTeam() {
            const port = document.getElementById('view-port');
            port.innerHTML = `<h3>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ M.C.</h3><div id="team-list"></div>`;
            const list = document.getElementById('team-list');

            DB.users.forEach(u => {
                let dots = '';
                for(let i=1; i<=3; i++) dots += `<div class="warn-dot ${u.warns >= i ? 'warn-red' : ''}"></div>`;
                list.innerHTML += `
                    <div class="order-card" style="display:flex; align-items:center; gap:15px;">
                        <div style="width:50px; height:50px; background:#111; border-radius:50%; border:1px solid #333; display:flex; align-items:center; justify-content:center; font-weight:bold;">${u.name[0]}</div>
                        <div style="flex:1;">
                            <b>${u.name}</b> <small style="color:gray;">(${u.role})</small><br>
                            <small>XP: ${u.xp}</small>
                            <div style="margin-top:5px;">${dots}</div>
                        </div>
                        ${me.role === 'director' && u.phone !== me.phone ? `<button onclick="addWarn('${u.phone}')" style="background:red; border:none; color:white; padding:5px; font-size:0.6rem; border-radius:5px;">–í–´–ì–û–í–û–†</button>` : ''}
                    </div>
                `;
            });
        }

        function addWarn(ph) {
            let u = DB.users.find(x => x.phone === ph);
            if(u) { u.warns++; save(); renderTeam(); notify('–í–´–ì–û–í–û–† –í–´–î–ê–ù'); }
        }

        // --- –°–û–ó–î–ê–ù–ò–ï ---
        function renderAdd() {
            if(me.role === 'programmer') return notify('–ù–ï–¢ –ü–†–ê–í');
            document.getElementById('view-port').innerHTML = `
                <h3>–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</h3>
                <input id="in-c" placeholder="–ö–ª–∏–µ–Ω—Ç">
                <input id="in-p" type="number" placeholder="–ë—é–¥–∂–µ—Ç (—Å–æ–º)">
                <textarea id="in-d" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞"></textarea>
                <button class="btn btn-white" onclick="saveOrder()">–°–û–ó–î–ê–¢–¨</button>
            `;
        }

        function saveOrder() {
            const c = document.getElementById('in-c').value;
            const p = document.getElementById('in-p').value;
            const d = document.getElementById('in-d').value;
            if(!c || !p) return notify('–ó–ê–ü–û–õ–ù–ò–¢–ï –ü–û–õ–Ø');
            DB.orders.push({ client: c, price: p, desc: d, status: 'new' });
            save(); notify('–ì–û–¢–û–í–û'); tab('orders');
        }

        // --- –ö–ê–°–°–ê ---
        function renderFin() {
            const profit = DB.orders.filter(o => o.status === 'done').reduce((a, b) => a + Number(b.price), 0);
            document.getElementById('view-port').innerHTML = `
                <div style="text-align:center; padding-top:50px;">
                    <small>–û–ë–©–ò–ô –î–û–•–û–î</small>
                    <h1 style="color:var(--gold); font-size:3rem;">${profit} —Å–æ–º</h1>
                </div>
            `;
        }

        /* --- –°–ò–°–¢–ï–ú–ù–´–ï --- */
        function updSt(i, st) { 
            DB.orders[i].status = st; 
            if(st === 'done') {
                let u = DB.users.find(x => x.name === me.name);
                if(u) u.xp++;
            }
            save(); tab('orders'); 
        }
        function save() { localStorage.setItem('mc_v19_chat', JSON.stringify(DB)); }
        function notify(m) { const t=document.getElementById('toast'); t.innerText=m; t.style.display='block'; setTimeout(()=>t.style.display='none', 2000); }
        function toggleReg(s) { document.getElementById('login-box').style.display=s?'none':'block'; document.getElementById('reg-box').style.display=s?'block':'none'; }
        function fullReset() { if(confirm('–°–ë–†–û–°–ò–¢–¨ –í–°–Å?')) { loc
