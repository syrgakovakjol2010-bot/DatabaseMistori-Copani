<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>S.A.B. ULTIMATE v10.0</title>
    <style>
        /* --- –ê–î–ê–ü–¢–ò–í–ù–´–ô –î–ò–ó–ê–ô–ù (MOBILE FIRST) --- */
        :root { --bg: #000; --card: #0a0a0a; --border: #222; --accent: #fff; --gold: #ffd700; }
        
        body { background: var(--bg); color: #fff; font-family: -apple-system, system-ui, sans-serif; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        
        /* –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è */
        .auth-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; box-sizing: border-box; }
        .auth-card { width: 100%; max-width: 340px; border: 1px solid var(--border); padding: 30px; background: var(--card); border-radius: 12px; text-align: center; }
        
        input, select, textarea { width: 100%; padding: 14px; margin: 10px 0; background: #111; border: 1px solid #333; color: #fff; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        button { width: 100%; padding: 14px; border-radius: 8px; font-weight: bold; border: none; cursor: pointer; text-transform: uppercase; transition: 0.2s; font-size: 14px; }
        .btn-main { background: var(--accent); color: #000; }
        .btn-sec { background: transparent; color: #888; border: 1px solid #333; margin-top: 10px; }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        #app { display: none; flex-direction: column; min-height: 100vh; }
        .top-bar { padding: 15px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; background: #050505; position: sticky; top: 0; z-index: 100; }
        
        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 15px; background: var(--bg); }
        .stat-box { border: 1px solid var(--border); padding: 12px; border-radius: 8px; text-align: center; background: var(--card); }
        .stat-val { display: block; font-size: 1.3rem; font-weight: bold; margin-top: 5px; }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç */
        .main { padding: 15px; flex: 1; padding-bottom: 100px; }
        .card { background: var(--card); border: 1px solid var(--border); padding: 15px; border-radius: 10px; margin-bottom: 15px; position: relative; }
        
        /* –†–æ–ª–∏ –∏ –†–∞–Ω–≥–∏ */
        .role-tag { font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; border: 1px solid #555; text-transform: uppercase; margin-left: 5px; }
        .role-director { color: #ff00ff; border-color: #ff00ff; }
        .role-manager { color: #00ff00; border-color: #00ff00; }
        .role-programmer { color: #0088ff; border-color: #0088ff; }

        /* –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: #080808; border-top: 1px solid var(--border); display: flex; justify-content: space-around; padding: 12px 0; }
        .nav-item { background: none; border: none; color: #666; font-size: 0.7rem; display: flex; flex-direction: column; align-items: center; gap: 5px; width: auto; }
        .nav-item.active { color: #fff; }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #fff; color: #000; padding: 12px 24px; border-radius: 50px; font-weight: bold; display: none; z-index: 1000; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

    <div id="toast"></div>

    <div id="login-screen" class="auth-screen">
        <div class="auth-card">
            <h1>S.A.B.</h1>
            <p style="color: #555; font-size: 0.8rem; margin-bottom: 20px;">SYSTEM v10.0</p>
            <input type="text" id="l-phone" placeholder="705163333">
            <input type="password" id="l-pass" placeholder="–ü–∞—Ä–æ–ª—å">
            <button class="btn-main" onclick="handleLogin()">–í–û–ô–¢–ò</button>
            <button class="btn-sec" onclick="showReg(true)">–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</button>
        </div>
    </div>

    <div id="reg-screen" class="auth-screen" style="display:none;">
        <div class="auth-card">
            <h2>–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</h2>
            <input type="text" id="r-name" placeholder="–ò–º—è">
            <input type="text" id="r-phone" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞">
            <input type="password" id="r-pass" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å">
            <button class="btn-main" onclick="handleReg()">–°–û–ó–î–ê–¢–¨ –ê–ö–ö–ê–£–ù–¢</button>
            <button class="btn-sec" onclick="showReg(false)">–ù–ê–ó–ê–î</button>
        </div>
    </div>

    <div id="app">
        <div class="top-bar">
            <div>
                <b id="u-name">Akjol</b> <span class="role-tag role-director" id="u-role">DIRECTOR</span>
            </div>
            <button onclick="logout()" style="width:auto; padding:5px 10px; background:none; border:1px solid red; color:red; font-size:0.7rem;">–í–´–•–û–î</button>
        </div>

        <div class="stats">
            <div class="stat-box">–í –†–ê–ë–û–¢–ï <span class="stat-val" id="stat-work">0</span></div>
            <div class="stat-box" style="border-color:var(--gold)">–ö–ê–°–°–ê <span class="stat-val" id="stat-money" style="color:var(--gold)">0 —Å</span></div>
        </div>

        <div class="main" id="view">
            </div>

        <div class="bottom-nav">
            <button class="nav-item active" id="n-orders" onclick="switchTab('orders')">üì¶ –ó–ê–ö–ê–ó–´</button>
            <button class="nav-item" id="n-add" onclick="switchTab('add')">‚ûï –î–û–ë–ê–í–ò–¢–¨</button>
            <button class="nav-item" id="n-staff" onclick="switchTab('staff')">üë• –ö–û–ú–ê–ù–î–ê</button>
        </div>
    </div>

    <script>
        /* --- –õ–û–ì–ò–ö–ê –°–ò–°–¢–ï–ú–´ --- */

        let DB = JSON.parse(localStorage.getItem('sab_db_v10')) || { 
            users: [
                { name: "–°–æ–ª—Ç–æ", phone: "700000000", pass: "1234", role: "manager", xp: 0 }
            ], 
            orders: [] 
        };

        let me = null;

        // –í–•–û–î
        function handleLogin() {
            const ph = document.getElementById('l-phone').value.trim();
            const ps = document.getElementById('l-pass').value.trim();

            if (ph === '705163333' && ps === 'admin123') {
                me = { name: "–ê–∫–∂–æ–ª", phone: "705163333", role: "director" };
                initApp();
            } else {
                let user = DB.users.find(u => u.phone === ph && u.pass === ps);
                if (user) { me = user; initApp(); } 
                else { notify('–û—à–∏–±–∫–∞: –ù–µ–≤–µ—Ä–Ω—ã–π –≤—Ö–æ–¥'); }
            }
        }

        // –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø
        function handleReg() {
            const n = document.getElementById('r-name').value;
            const p = document.getElementById('r-phone').value;
            const ps = document.getElementById('r-pass').value;
            if(!n || !p || !ps) return notify('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');

            if(DB.users.find(u => u.phone === p) || p === '705163333') {
                return notify('–≠—Ç–æ—Ç –Ω–æ–º–µ—Ä —É–∂–µ –∑–∞–Ω—è—Ç!');
            }

            DB.users.push({ name: n, phone: p, pass: ps, role: "programmer", xp: 0 });
            save();
            notify('–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω! –í–æ–π–¥–∏—Ç–µ.');
            setTimeout(() => location.reload(), 1000);
        }

        function initApp() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app').style.display = 'flex';
            document.getElementById('u-name').innerText = me.name;
            document.getElementById('u-role').innerText = me.role.toUpperCase();
            document.getElementById('u-role').className = 'role-tag role-' + me.role;
            
            updateStats();
            switchTab('orders');
        }

        // –£–ü–†–ê–í–õ–ï–ù–ò–ï –í–ö–õ–ê–î–ö–ê–ú–ò
        function switchTab(tab) {
            const v = document.getElementById('view');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            document.getElementById('n-' + tab).classList.add('active');

            if(tab === 'orders') renderOrders();
            if(tab === 'add') renderAddForm();
            if(tab === 'staff') renderStaff();
        }

        // –ó–ê–ö–ê–ó–´
        function renderOrders() {
            const v = document.getElementById('view');
            v.innerHTML = '<h3>–ê–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã</h3>';
            
            let orders = DB.orders.filter(o => o.status !== 'archive');
            if(orders.length === 0) v.innerHTML += '<p style="color:#444">–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>';

            orders.reverse().forEach((o, i) => {
                let realIdx = DB.orders.indexOf(o);
                v.innerHTML += `
                    <div class="card">
                        <div style="color:var(--gold); font-weight:bold; float:right;">${o.price} —Å</div>
                        <b>${o.client}</b>
                        <p style="font-size:0.8rem; color:#aaa; margin:5px 0;">${o.desc}</p>
                        <div style="font-size:0.7rem; color:#666;">–î–µ–¥–ª–∞–π–Ω: ${o.date}</div>
                        <div style="margin-top:10px; display:flex; gap:10px;">
                            ${o.status === 'new' ? `<button onclick="setSt(${realIdx},'work')" style="background:#00ff00; color:#000;">–í–ó–Ø–¢–¨</button>` : ''}
                            ${o.status === 'work' ? `<button onclick="setSt(${realIdx},'done')" style="background:yellow; color:#000;">–ó–ê–í–ï–†–®–ò–¢–¨</button>` : ''}
                            ${['director','manager'].includes(me.role) ? `<button onclick="setSt(${realIdx},'archive')" style="background:none; border:1px solid red; color:red;">–£–î–ê–õ–ò–¢–¨</button>` : ''}
                        </div>
                    </div>
                `;
            });
        }

        function renderAddForm() {
            if(me.role === 'programmer') return notify('–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤');
            document.getElementById('view').innerHTML = `
                <h3>–ù–æ–≤—ã–π –∑–∞–∫–∞–∑</h3>
                <input id="o-client" placeholder="–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞">
                <input id="o-price" type="number" placeholder="–ë—é–¥–∂–µ—Ç (—Å–æ–º)">
                <textarea id="o-desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ (–¢–ó)" style="height:100px;"></textarea>
                <input id="o-date" type="date">
                <button class="btn-main" onclick="addOrder()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
            `;
        }

        function addOrder() {
            const c = document.getElementById('o-client').value;
            const p = document.getElementById('o-price').value;
            const d = document.getElementById('o-desc').value;
            const dt = document.getElementById('o-date').value;
            if(!c || !p || !dt) return notify('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ');

            DB.orders.push({ client: c, price: p, desc: d, date: dt, status: 'new' });
            save();
            updateStats();
            switchTab('orders');
            notify('–ó–∞–∫–∞–∑ –¥–æ–±–∞–≤–ª–µ–Ω!');
        }

        // –ö–û–ú–ê–ù–î–ê –ò –ü–û–í–´–®–ï–ù–ò–ï
        function renderStaff() {
            const v = document.getElementById('view');
            v.innerHTML = '<h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–æ–π</h3>';
            
            // –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤–∫–ª—é—á–∞—è –∞–¥–º–∏–Ω–∞
            let allUsers = [...DB.users];
            
            allUsers.forEach((u, i) => {
                let isMe = u.phone === me.phone;
                v.innerHTML += `
                    <div class="card">
                        <b>${u.name}</b> <span class="role-tag role-${u.role}">${u.role.toUpperCase()}</span>
                        <div style="font-size:0.7rem; color:gray; margin-top:5px;">${u.phone}</div>
                        
                        ${me.role === 'director' && !isMe ? `
                            <div style="margin-top:10px; display:flex; gap:5px;">
                                <button onclick="changeRole('${u.phone}', 'programmer')" style="font-size:0.6rem; padding:5px; background:#333;">–ü–†–û–ì</button>
                                <button onclick="changeRole('${u.phone}', 'manager')" style="font-size:0.6rem; padding:5px; background:#00ff00; color:#000;">–ú–ï–ù–ï–î–ñ–ï–†</button>
                                <button onclick="changeRole('${u.phone}', 'deputy')" style="font-size:0.6rem; padding:5px; background:#ff00ff; color:#fff;">–ó–ê–ú</button>
                                <button onclick="fireUser('${u.phone}')" style="font-size:0.6rem; padding:5px; background:red; color:#fff;">–£–í–û–õ–ò–¢–¨</button>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
        }

        function changeRole(phone, newRole) {
            let u = DB.users.find(user => user.phone === phone);
            if(u) {
                u.role = newRole;
                save();
                renderStaff();
                notify('–†–æ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞ ' + newRole.toUpperCase());
            }
        }

        // –°–ò–°–¢–ï–ú–ù–´–ï –§–£–ù–ö–¶–ò–ò
        function setSt(i, st) {
            DB.orders[i].status = st;
            save();
            updateStats();
            renderOrders();
            notify('–°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª–µ–Ω');
        }

        function save() { localStorage.setItem('sab_db_v10', JSON.stringify(DB)); }
        
        function updateStats() {
            const work = DB.orders.filter(o => o.status === 'work').length;
            const money = DB.orders.filter(o => o.status === 'done').reduce((acc, v) => acc + Number(v.price), 0);
            document.getElementById('stat-work').innerText = work;
            document.getElementById('stat-money').innerText = money + ' —Å';
        }

        function notify(m) {
            const t = document.getElementById('toast');
            t.innerText = m; t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 2500);
        }

        function fireUser(ph) {
            if(confirm('–£–≤–æ–ª–∏—Ç—å —ç—Ç–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞?')) {
                DB.users = DB.users.filter(u => u.phone !== ph);
                save();
                renderStaff();
                notify('–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —É–≤–æ–ª–µ–Ω');
            }
        }

        function showReg(show) {
            document.getElementById('login-screen').style.display = show ? 'none' : 'flex';
            document.getElementById('reg-screen').style.display = show ? 'flex' : 'none';
        }

        function logout() { location.reload(); }

    </script>
</body>
</html>
