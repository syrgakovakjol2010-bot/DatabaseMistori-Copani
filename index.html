<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>S.A.B. ULTIMATE v9.0</title>
    <style>
        /* --- –°–¢–ò–õ–ò (BLACK & WHITE) --- */
        body { background: #000; color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è */
        .auth-container { display: flex; align-items: center; justify-content: center; height: 100vh; background: #000; }
        .auth-card { width: 320px; border: 1px solid #333; padding: 35px; text-align: center; background: #050505; border-radius: 8px; box-shadow: 0 0 20px rgba(255,255,255,0.05); }
        input, textarea, select { width: 100%; box-sizing: border-box; background: #111; border: 1px solid #444; color: #fff; padding: 12px; margin: 8px 0; border-radius: 4px; outline: none; }
        input:focus { border-color: #fff; }
        button { cursor: pointer; padding: 12px; text-transform: uppercase; font-weight: bold; width: 100%; border: none; border-radius: 4px; transition: 0.2s; }
        .btn-white { background: #fff; color: #000; }
        .btn-outline { background: transparent; color: #888; border: 1px solid #333; margin-top: 10px; }

        /* –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ */
        #app { display: none; height: 100%; }
        .sidebar { width: 260px; border-right: 1px solid #222; padding: 20px; background: #080808; display: flex; flex-direction: column; gap: 10px; }
        .content { flex: 1; padding: 20px; overflow-y: auto; background: #000; position: relative; }

        /* –®–∞–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è */
        .user-header { display: flex; align-items: center; gap: 12px; padding-bottom: 20px; border-bottom: 1px solid #222; margin-bottom: 15px; }
        .avatar { width: 42px; height: 42px; background: #222; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 1px solid #444; }
        
        /* –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é */
        .nav-btn { background: transparent; color: #aaa; text-align: left; padding: 12px; border-radius: 6px; display: flex; align-items: center; gap: 10px; }
        .nav-btn:hover, .nav-btn.active { background: #1a1a1a; color: #fff; border-left: 3px solid #fff; }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 25px; }
        .stat-card { background: #080808; border: 1px solid #222; padding: 12px; text-align: center; border-radius: 6px; }
        .stat-num { font-size: 1.4rem; font-weight: bold; display: block; margin-top: 5px; }
        .gold { color: #ffd700; text-shadow: 0 0 5px rgba(255,215,0,0.2); }

        /* –ó–∞–∫–∞–∑—ã */
        .filter-row { display: flex; gap: 8px; margin-bottom: 15px; overflow-x: auto; }
        .chip { background: #111; border: 1px solid #333; color: #777; padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; cursor: pointer; white-space: nowrap; }
        .chip.active { background: #fff; color: #000; }
        
        .order-card { background: #0a0a0a; border: 1px solid #222; padding: 20px; margin-bottom: 15px; border-radius: 8px; position: relative; }
        .price-label { position: absolute; top: 15px; right: 15px; color: #ffd700; border: 1px solid #ffd700; padding: 2px 8px; border-radius: 4px; font-weight: bold; }
        
        .notes-box { background: #050505; border: 1px dashed #333; padding: 10px; margin: 15px 0; font-size: 0.85rem; color: #999; border-radius: 4px; }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        #toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #fff; color: #000; padding: 12px 25px; border-radius: 30px; font-weight: bold; display: none; z-index: 9999; box-shadow: 0 5px 20px rgba(0,0,0,0.5); }

        /* –°—Ç–∞—Ç—É—Å—ã –∏ –†–∞–Ω–≥–∏ */
        .st-new { color: #00ff00; } .st-work { color: yellow; } .st-done { color: red; }
        .hot { color: #ff4444; font-weight: bold; animation: blink 1.5s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }

        .badge { font-size: 0.65rem; padding: 2px 6px; border-radius: 3px; margin-left: 8px; text-transform: uppercase; }
        .bg-jun { background: #444; } .bg-mid { background: #0055ff; } .bg-sen { background: #ff00ff; }
    </style>
</head>
<body>

    <div id="toast"></div>

    <div id="auth-screen" class="auth-container">
        <div class="auth-card">
            <h1 style="letter-spacing: 5px; margin: 0;">S.A.B.</h1>
            <p style="color: #555; font-size: 0.7rem; margin-bottom: 25px;">STUDIO MANAGEMENT v9.0</p>
            <input type="text" id="log-phone" placeholder="–ù–æ–º–µ—Ä (705163333)">
            <input type="password" id="log-pass" placeholder="–ü–∞—Ä–æ–ª—å (admin123)">
            <button class="btn-white" onclick="login()">–í–û–ô–¢–ò</button>
            <button class="btn-outline" onclick="toggleAuth(true)">–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</button>
            <button onclick="clearSystem()" style="background:none; color:#333; font-size:0.6rem; margin-top:20px;">–°–±—Ä–æ—Å–∏—Ç—å –ø–∞–º—è—Ç—å (Reset)</button>
        </div>
    </div>

    <div id="reg-screen" class="auth-container" style="display:none;">
        <div class="auth-card">
            <h2>–ù–û–í–´–ô –°–û–¢–†–£–î–ù–ò–ö</h2>
            <input type="text" id="reg-name" placeholder="–ò–º—è">
            <input type="text" id="reg-phone" placeholder="–ù–æ–º–µ—Ä">
            <input type="password" id="reg-pass" placeholder="–ü–∞—Ä–æ–ª—å">
            <button class="btn-white" onclick="register()">–°–û–ó–î–ê–¢–¨ –ê–ö–ö–ê–£–ù–¢</button>
            <button class="btn-outline" onclick="toggleAuth(false)">–ù–ê–ó–ê–î</button>
        </div>
    </div>

    <div id="app">
        <div class="sidebar">
            <div class="user-header">
                <div class="avatar" id="u-ava">?</div>
                <div>
                    <div id="u-name" style="font-weight:bold;">Name</div>
                    <div id="u-role" style="font-size:0.75rem; color:gray;">Role</div>
                </div>
            </div>
            <button class="nav-btn active" id="nav-orders" onclick="showSection('orders')">üìÅ –ó–ê–ö–ê–ó–´</button>
            <button class="nav-btn" id="nav-staff" onclick="showSection('staff')">üë• –ö–û–ú–ê–ù–î–ê</button>
            <button class="nav-btn" id="nav-add" style="display:none; color:#00ff00;" onclick="showSection('add')">+ –ù–û–í–´–ô –ó–ê–ö–ê–ó</button>
            
            <div style="margin-top:auto;">
                <button class="nav-btn" onclick="backup()" style="font-size:0.7rem;">üíæ –°–ö–ê–ß–ê–¢–¨ –ë–ê–ó–£</button>
                <button class="nav-btn" onclick="location.reload()" style="color:red;">–í–´–•–û–î</button>
            </div>
        </div>

        <div class="content">
            <div class="stats-grid">
                <div class="stat-card">–°–í–û–ë–û–î–ù–û <span class="stat-num" id="stat-free">0</span></div>
                <div class="stat-card">–í –†–ê–ë–û–¢–ï <span class="stat-num" id="stat-work">0</span></div>
                <div class="stat-card">–ó–ê–ö–†–´–¢–û <span class="stat-num" id="stat-done">0</span></div>
                <div class="stat-card" style="border-color:#ffd700;">–ö–ê–°–°–ê <span class="stat-num gold" id="stat-money">0</span></div>
            </div>
            <div id="view"></div>
        </div>
    </div>

    <script>
        /* --- JS LOGIC --- */
        let DB = JSON.parse(localStorage.getItem('sab_db_v9')) || { 
            users: [{ name: "–°–æ–ª—Ç–æ", phone: "700000000", pass: "1234", role: "manager", xp: 5 }], 
            orders: [] 
        };
        let user = null;
        let filter = 'all';

        // 1. –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø
        function login() {
            const p = document.getElementById('log-phone').value.trim();
            const ps = document.getElementById('log-pass').value.trim();
            if (p === '705163333' && ps === 'admin123') {
                user = { name: "–°.–ê.–ë", phone: p, role: "director", xp: 999 };
                initApp();
            } else {
                let found = DB.users.find(u => u.phone === p && u.pass === ps);
                if (found) { user = found; initApp(); } 
                else { msg('–û—à–∏–±–∫–∞: –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ'); }
            }
        }

        function register() {
            const n = document.getElementById('reg-name').value;
            const p = document.getElementById('reg-phone').value;
            const ps = document.getElementById('reg-pass').value;
            if(!n || !p || !ps) return msg('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
            if(DB.users.find(u => u.phone === p) || p === '705163333') return msg('–ù–æ–º–µ—Ä —É–∂–µ –∑–∞–Ω—è—Ç');
            DB.users.push({ name: n, phone: p, pass: ps, role: "programmer", xp: 0 });
            save(); msg('–£—Å–ø–µ—à–Ω–æ! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏—Ç–µ.'); toggleAuth(false);
        }

        function initApp() {
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('reg-screen').style.display = 'none';
            document.getElementById('app').style.display = 'flex';
            document.getElementById('u-name').innerText = user.name;
            document.getElementById('u-role').innerText = user.role.toUpperCase();
            document.getElementById('u-ava').innerText = user.name[0];
            if(user.role !== 'programmer') document.getElementById('nav-add').style.display = 'flex';
            updateStats(); showSection('orders');
        }

        // 2. –ó–ê–ö–ê–ó–´
        function renderOrders(search = '') {
            const view = document.getElementById('view');
            view.innerHTML = `
                <div class="filter-row">
                    <button class="chip ${filter==='all'?'active':''}" onclick="setFilter('all')">–í—Å–µ</button>
                    <button class="chip ${filter==='new'?'active':''}" onclick="setFilter('new')">–°–≤–æ–±–æ–¥–Ω—ã–µ</button>
                    <button class="chip ${filter==='work'?'active':''}" onclick="setFilter('work')">–í —Ä–∞–±–æ—Ç–µ</button>
                    <button class="chip ${filter==='done'?'active':''}" onclick="setFilter('done')">–ì–æ—Ç–æ–≤—ã–µ</button>
                </div>
                <input placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∫–ª–∏–µ–Ω—Ç—É –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏—é..." onkeyup="renderOrders(this.value)" value="${search}">
            `;

            let list = DB.orders.filter(o => {
                let fMatch = (filter === 'all' && o.status !== 'archive') || o.status === filter;
                let sMatch = o.client.toLowerCase().includes(search.toLowerCase()) || o.desc.toLowerCase().includes(search.toLowerCase());
                return fMatch && sMatch;
            });

            list.forEach((ord, i) => {
                const realIdx = DB.orders.indexOf(ord);
                const isLate = (ord.status !== 'done' && ord.date <= new Date().toISOString().split('T')[0]);
                let notes = (ord.notes || []).map(n => `<div>‚Ä¢ ${n}</div>`).join('');

                view.innerHTML += `
                    <div class="order-card" style="${isLate?'border-color:red':''}">
                        <div class="price-label">${ord.price} —Å</div>
                        <h3>${ord.client}</h3>
                        <p style="color:#aaa; font-size:0.9rem;">${ord.desc}</p>
                        <div class="notes-box">${notes || '–ó–∞–º–µ—Ç–æ–∫ –Ω–µ—Ç'} <div onclick="addNote(${realIdx})" style="color:#00ff00; cursor:pointer; margin-top:5px; font-size:0.7rem;">+ –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É</div></div>
                        <div style="display:flex; justify-content:space-between; align-items:center; border-top:1px solid #222; padding-top:10px;">
                            <span class="${isLate?'hot':''}" style="font-size:0.8rem;">üìÖ ${ord.date}</span>
                            <div>
                                ${ord.status === 'new' ? `<button onclick="setSt(${realIdx},'work')" style="background:#00ff00; color:#000; width:auto; padding:5px 10px;">–í–ó–Ø–¢–¨</button>` : ''}
                                ${ord.status === 'work' && (ord.worker === user.name || user.role === 'director') ? `<button onclick="setSt(${realIdx},'done')" style="background:yellow; color:#000; width:auto; padding:5px 10px;">–ó–ê–ö–†–´–¢–¨</button>` : ''}
                                ${user.role === 'director' ? `<button onclick="edit(${realIdx})" style="background:none; color:gray; width:auto; font-size:0.7rem;">–†–ï–î.</button> <button onclick="setSt(${realIdx},'archive')" style="background:none; color:red; width:auto; font-size:0.7rem;">–£–î–ê–õ–ò–¢–¨</button>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        function addOrder() {
            const c = document.getElementById('o-c').value;
            const p = document.getElementById('o-p').value;
            const d = document.getElementById('o-d').value;
            const dt = document.getElementById('o-dt').value;
            if(!c || !p || !dt) return msg('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
            DB.orders.push({ client: c, price: p, desc: d, date: dt, status: 'new', notes: [], worker: null });
            save(); updateStats(); msg('–ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω!'); showSection('orders');
        }

        // 3. –ö–û–ú–ê–ù–î–ê
        function renderStaff() {
            const view = document.getElementById('view');
            view.innerHTML = '<h2>–†–µ–π—Ç–∏–Ω–≥ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h2>';
            let sorted = [...DB.users].sort((a,b) => (b.xp||0) - (a.xp||0));
            sorted.forEach(u => {
                let rank = u.xp >= 10 ? {n:'Senior', c:'bg-sen'} : (u.xp >= 3 ? {n:'Middle', c:'bg-mid'} : {n:'Junior', c:'bg-jun'});
                view.innerHTML += `
                    <div class="order-card" style="display:flex; align-items:center; justify-content:space-between;">
                        <div style="display:flex; align-items:center; gap:15px;">
                            <div class="avatar">${u.name[0]}</div>
                            <div><b>${u.name}</b> <span class="badge ${rank.c}">${rank.n}</span><br><small style="color:gray">${u.role} | XP: ${u.xp||0}</small></div>
                        </div>
                        ${user.role === 'director' && u.phone !== '705163333' ? `<button onclick="fire('${u.phone}')" style="background:none; color:red; width:auto;">–£–í–û–õ–ò–¢–¨</button>` : ''}
                    </div>
                `;
            });
        }

        // 4. –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï
        function setSt(i, st) {
            DB.orders[i].status = st;
            if(st === 'work') DB.orders[i].worker = user.name;
            if(st === 'done') {
                let w = DB.users.find(u => u.name === DB.orders[i].worker);
                if(w) w.xp = (w.xp || 0) + 1;
            }
            save(); updateStats(); renderOrders(); msg('–û–±–Ω–æ–≤–ª–µ–Ω–æ');
        }

        function addNote(i) {
            let n = prompt("–¢–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏:");
            if(n) { DB.orders[i].notes.push(n); save(); renderOrders(); }
        }

        function edit(i) {
            let p = prompt("–ù–æ–≤–∞—è —Ü–µ–Ω–∞:", DB.orders[i].price);
            let d = prompt("–ù–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:", DB.orders[i].desc);
            if(p && d) { DB.orders[i].price = p; DB.orders[i].desc = d; save(); renderOrders(); }
        }

        function save() { localStorage.setItem('sab_db_v9', JSON.stringify(DB)); }
        
        function updateStats() {
            document.getElementById('stat-free').innerText = DB.orders.filter(o => o.status === 'new').length;
            document.getElementById('stat-work').innerText = DB.orders.filter(o => o.status === 'work').length;
            document.getElementById('stat-done').innerText = DB.orders.filter(o => o.status === 'done').length;
            let m = DB.orders.filter(o => o.status === 'done').reduce((a, b) => a + Number(b.price), 0);
            document.getElementById('stat-money').innerText = m + ' c';
        }

        function showSection(s) {
            const view = document.getElementById('view');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            if(s === 'orders') { renderOrders(); document.getElementById('nav-orders').classList.add('active'); }
            if(s === 'staff') { renderStaff(); document.getElementById('nav-staff').classList.add('active'); }
            if(s === 'add') {
                document.getElementById('nav-add').classList.add('active');
                view.innerHTML = `<h3>–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</h3><input id="o-c" placeholder="–ö–ª–∏–µ–Ω—Ç"><input id="o-p" type="number" placeholder="–ë—é–¥–∂–µ—Ç (—Å–æ–º)"><textarea id="o-d" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ/–¢–ó"></textarea><input id="o-dt" type="date"><button class="btn-white" onclick="addOrder()">–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</button>`;
            }
        }

        function msg(m) {
            const t = document.getElementById('toast');
            t.innerText = m; t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 2500);
        }

        function toggleAuth(reg) {
            document.getElementById('auth-screen').style.display = reg ? 'none' : 'flex';
            document.getElementById('reg-screen').style.display = reg ? 'flex' : 'none';
        }

        function setFilter(f) { filter = f; renderOrders(); }
        function fire(ph) { if(confirm('–£–≤–æ–ª–∏—Ç—å?')) { DB.users = DB.users.filter(u => u.phone !== ph); save(); renderStaff(); } }
        function clearSystem() { if(confirm('–≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ. –í—ã —É–≤–µ—Ä–µ–Ω—ã?')) { localStorage.clear(); location.reload(); } }
        function backup() {
            let data = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(DB));
            let a = document.createElement('a'); a.href = data; a.download = "sab_backup.json"; a.click();
        }
    </script>
</body>
</html>
