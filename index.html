<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M.C. ULTIMATE | STABLE v20.0</title>
    <style>
        /* --- CSS: –î–ò–ó–ê–ô–ù –ò –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ --- */
        :root {
            --bg: #000; --card: #0a0a0a; --border: #1a1a1a; --text: #fff;
            --dim: #666; --gold: #ffd700; --green: #00ff66; --red: #ff3333; --blue: #0088ff;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; padding: 0; overflow: hidden; height: 100vh; }

        /* –í—Ö–æ–¥ –∏ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è */
        .auth-screen { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; background: #000; z-index: 5000; padding: 20px; }
        .auth-card { width: 100%; max-width: 360px; background: var(--card); border: 1px solid var(--border); padding: 35px; border-radius: 25px; text-align: center; }
        
        input, textarea { width: 100%; padding: 14px; margin: 8px 0; background: #111; border: 1px solid #333; color: #fff; border-radius: 12px; font-size: 16px; }
        .btn { width: 100%; padding: 15px; border-radius: 12px; font-weight: bold; border: none; cursor: pointer; text-transform: uppercase; transition: 0.2s; }
        .btn-white { background: #fff; color: #000; }
        .btn-out { background: transparent; color: var(--dim); border: 1px solid #222; margin-top: 10px; }

        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
        #app { display: none; height: 100vh; flex-direction: row; }
        .sidebar { width: 260px; background: #050505; border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 25px; }
        .main { flex: 1; display: flex; flex-direction: column; position: relative; }
        .top-bar { padding: 15px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); }
        .view { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–∫–∞–∑–æ–≤ */
        .card { background: var(--card); border: 1px solid var(--border); padding: 20px; border-radius: 20px; margin-bottom: 15px; position: relative; }
        .price { position: absolute; top: 20px; right: 20px; color: var(--gold); font-weight: bold; border: 1px solid var(--gold); padding: 3px 8px; border-radius: 6px; font-size: 0.8rem; }
        .ref { background: #000; border: 1px dashed #333; padding: 10px; border-radius: 8px; font-size: 0.8rem; color: var(--blue); margin-top: 10px; word-break: break-all; }

        /* –ß–∞—Ç */
        .chat-wrap { display: flex; flex-direction: column; height: 100%; max-width: 600px; margin: 0 auto; }
        .chat-msgs { flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 10px; }
        .m { padding: 10px 15px; border-radius: 15px; max-width: 85%; font-size: 0.9rem; }
        .m-me { align-self: flex-end; background: #fff; color: #000; }
        .m-ot { align-self: flex-start; background: #1a1a1a; border: 1px solid #333; }
        .chat-in { display: flex; gap: 10px; padding: 15px; border-top: 1px solid var(--border); }

        /* –ö–æ–º–∞–Ω–¥–∞ */
        .dot { width: 8px; height: 8px; background: #222; border-radius: 50%; display: inline-block; margin-right: 3px; }
        .dot-on { background: var(--red); box-shadow: 0 0 5px var(--red); }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è (–ú–æ–±–∏–ª—å–Ω–∞—è) */
        .nav { position: fixed; bottom: 0; width: 100%; background: #080808; border-top: 1px solid var(--border); display: flex; justify-content: space-around; padding: 10px 0; z-index: 1000; }
        .nav-link { background: none; border: none; color: #444; font-size: 0.6rem; font-weight: bold; text-align: center; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .nav-link.active { color: #fff; }

        @media (max-width: 900px) { .sidebar { display: none; } }
        @media (min-width: 901px) { .nav { display: none; } }

        #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #fff; color: #000; padding: 10px 25px; border-radius: 50px; font-weight: bold; display: none; z-index: 6000; }
    </style>
</head>
<body>

    <div id="toast"></div>

    <div id="auth-scr" class="auth-screen">
        <div class="auth-card" id="l-box">
            <h1 style="letter-spacing: 10px;">M.C.</h1>
            <p style="color: #444; font-size: 0.7rem; margin-bottom: 25px;">STABLE ULTIMATE v20.0</p>
            <input type="text" id="l-ph" placeholder="–ù–æ–º–µ—Ä (705 163 333)">
            <input type="password" id="l-ps" placeholder="–ü–∞—Ä–æ–ª—å">
            <button class="btn btn-white" onclick="login()">–í–û–ô–¢–ò</button>
            <button class="btn btn-out" onclick="toggleReg(true)">–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</button>
            <button onclick="clearCache()" style="background:none; border:none; color:red; font-size:0.6rem; margin-top:30px; cursor:pointer;">–û–ß–ò–°–¢–ò–¢–¨ –û–®–ò–ë–ö–ò –ü–ê–ú–Ø–¢–ò</button>
        </div>
        <div class="auth-card" id="r-box" style="display:none;">
            <h2>–ù–û–í–´–ô ID</h2>
            <input type="text" id="r-n" placeholder="–ò–º—è">
            <input type="text" id="r-p" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞">
            <input type="password" id="r-ps" placeholder="–ü–∞—Ä–æ–ª—å">
            <button class="btn btn-white" onclick="register()">–°–û–ó–î–ê–¢–¨</button>
            <button class="btn btn-out" onclick="toggleReg(false)">–ù–ê–ó–ê–î</button>
        </div>
    </div>

    <div id="app">
        <div class="sidebar">
            <h2 style="letter-spacing: 5px;">MISTORI</h2>
            <div style="display:flex; flex-direction:column; gap:8px; flex:1; margin-top:30px;">
                <button class="btn btn-out" onclick="go('orders')">–ó–ê–ö–ê–ó–´</button>
                <button class="btn btn-out" onclick="go('chat')">–ß–ê–¢</button>
                <button class="btn btn-out" onclick="go('team')">–ö–û–ú–ê–ù–î–ê</button>
                <button class="btn btn-out" onclick="go('add')">+ –ù–û–í–´–ô</button>
                <button class="btn btn-out" onclick="go('fin')">–ö–ê–°–°–ê</button>
            </div>
            <button class="btn btn-out" onclick="location.reload()" style="color:red;">–í–´–•–û–î</button>
        </div>

        <div class="main">
            <div class="top-bar">
                <div>
                    <b id="me-n">Akjol</b> <br>
                    <small id="me-r" style="color:var(--green); font-size:0.6rem; text-transform:uppercase;"></small>
                </div>
                <div style="font-weight:900; opacity:0.3; font-size:0.7rem;">MISTORI COPANI</div>
            </div>

            <div class="view" id="view">
                </div>

            <div class="nav">
                <button class="nav-link" id="n-orders" onclick="go('orders')">üì¶<br>–ó–ê–ö–ê–ó–´</button>
                <button class="nav-link" id="n-chat" onclick="go('chat')">üí¨<br>–ß–ê–¢</button>
                <button class="nav-link" id="n-team" onclick="go('team')">üë•<br>–ö–û–ú–ê–ù–î–ê</button>
                <button class="nav-link" id="n-add" onclick="go('add')">‚ûï<br>–ù–û–í–´–ô</button>
                <button class="nav-link" id="n-fin" onclick="go('fin')">üìä<br>–ö–ê–°–°–ê</button>
            </div>
        </div>
    </div>

    <script>
        /* --- JS –õ–û–ì–ò–ö–ê --- */
        let DB = JSON.parse(localStorage.getItem('mc_v20_stable')) || {
            users: [{ name: "–°–µ–∑–∏–º", phone: "777800603", pass: "admin2", role: "manager", xp: 5, warns: 0 }],
            orders: [],
            msgs: [{ u: "–°–∏—Å—Ç–µ–º–∞", t: "–ß–∞—Ç Mistori Copani –∑–∞–ø—É—â–µ–Ω!", time: "00:00" }]
        };
        let me = null;

        // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
        function login() {
            const ph = document.getElementById('l-ph').value.trim();
            const ps = document.getElementById('l-ps').value.trim();
            if (ph === '705163333' && ps === 'admin123') {
                me = { name: "–ê–∫–∂–æ–ª", phone: ph, role: "director" };
                startApp();
            } else {
                let u = DB.users.find(x => x.phone === ph && x.pass === ps);
                if (u) { me = u; startApp(); } else { msg('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞!'); }
            }
        }

        function register() {
            const n = document.getElementById('r-n').value;
            const p = document.getElementById('r-p').value;
            const ps = document.getElementById('r-ps').value;
            if(!n || !p || !ps) return msg('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å—ë!');
            DB.users.push({ name: n, phone: p, pass: ps, role: "programmer", xp: 0, warns: 0 });
            save(); msg('–ì–æ—Ç–æ–≤–æ! –í–æ–π–¥–∏—Ç–µ.'); location.reload();
        }

        function startApp() {
            document.getElementById('auth-scr').style.display = 'none';
            document.getElementById('app').style.display = 'flex';
            document.getElementById('me-n').innerText = me.name;
            document.getElementById('me-r').innerText = me.role;
            go('orders');
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        function go(t) {
            const v = document.getElementById('view');
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            if(document.getElementById('n-'+t)) document.getElementById('n-'+t).classList.add('active');

            if(t === 'orders') renderOrders();
            if(t === 'chat') renderChat();
            if(t === 'team') renderTeam();
            if(t === 'add') renderAdd();
            if(t === 'fin') renderFin();
        }

        // –°—Ç—Ä–∞–Ω–∏—Ü—ã
        function renderOrders() {
            const v = document.getElementById('view');
            v.innerHTML = '<h3>–ü—Ä–æ–µ–∫—Ç—ã M.C.</h3>';
            DB.orders.filter(o => o.st !== 'arc').reverse().forEach((o, i) => {
                let idx = DB.orders.indexOf(o);
                v.innerHTML += `
                    <div class="card">
                        <span class="price">${o.p} —Å</span>
                        <b>${o.c}</b> <br>
                        <small style="color:gray">${o.d}</small>
                        ${o.ref ? `<div class="ref">${o.ref}</div>` : ''}
                        <div style="margin-top:15px; display:flex; gap:10px;">
                            ${o.st === 'new' ? `<button onclick="updSt(${idx},'work')" class="btn btn-white" style="padding:5px 10px; width:auto; font-size:0.7rem;">–í–ó–Ø–¢–¨</button>` : ''}
                            ${o.st === 'work' ? `<button onclick="updSt(${idx},'done')" class="btn btn-white" style="background:var(--gold); padding:5px 10px; width:auto; font-size:0.7rem;">–ì–û–¢–û–í–û</button>` : ''}
                            ${me.role !== 'programmer' ? `<button onclick="updSt(${idx},'arc')" style="background:none; border:none; color:red; font-size:0.6rem;">–£–î–ê–õ–ò–¢–¨</button>` : ''}
                        </div>
                    </div>
                `;
            });
        }

        function renderChat() {
            const v = document.getElementById('view');
            v.innerHTML = `
                <div class="chat-wrap">
                    <div class="chat-msgs" id="chat-box"></div>
                    <div class="chat-in">
                        <input id="chat-txt" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
                        <button class="btn btn-white" onclick="sendMsg()" style="width:60px;">></button>
                    </div>
                </div>
            `;
            updateChat();
        }

        function updateChat() {
            const box = document.getElementById('chat-box');
            if(!box) return;
            box.innerHTML = '';
            DB.msgs.forEach(m => {
                const isMe = m.u === me.name;
                box.innerHTML += `
                    <div class="m ${isMe?'m-me':'m-ot'}">
                        <small style="font-size:0.6rem; opacity:0.5;">${m.u} | ${m.time}</small><br>${m.t}
                    </div>
                `;
            });
            box.scrollTop = box.scrollHeight;
        }

        function sendMsg() {
            const txt = document.getElementById('chat-txt').value;
            if(!txt) return;
            const now = new Date();
            DB.msgs.push({ u: me.name, t: txt, time: now.getHours()+':'+(now.getMinutes()<10?'0':'')+now.getMinutes() });
            document.getElementById('chat-txt').value = '';
            save(); updateChat();
        }

        function renderTeam() {
            const v = document.getElementById('view');
            v.innerHTML = '<h3>–ö–æ–º–∞–Ω–¥–∞</h3>';
            DB.users.forEach(u => {
                v.innerHTML += `
                    <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <b>${u.name}</b> (${u.role})<br>
                            <div style="margin-top:5px;">
                                <div class="dot ${u.warns>=1?'dot-on':''}"></div>
                                <div class="dot ${u.warns>=2?'dot-on':''}"></div>
                                <div class="dot ${u.warns>=3?'dot-on':''}"></div>
                            </div>
                        </div>
                        ${me.role==='director'&&u.phone!==me.phone ? `<button onclick="warn('${u.phone}')" style="background:red; color:white; border:none; padding:5px; border-radius:5px; font-size:0.6rem;">–í–´–ì–û–í–û–†</button>` : ''}
                    </div>
                `;
            });
        }

        function renderAdd() {
            if(me.role === 'programmer') return msg('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞');
            const v = document.getElementById('view');
            v.innerHTML = `
                <h3>–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</h3>
                <input id="ic" placeholder="–ö–ª–∏–µ–Ω—Ç">
                <input id="ip" type="number" placeholder="–¶–µ–Ω–∞">
                <textarea id="id" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ / –¢–ó"></textarea>
                <input id="ir" placeholder="–†–µ—Ñ–µ—Ä–µ–Ω—Å—ã (—Å—Å—ã–ª–∫–∏)">
                <button class="btn btn-white" onclick="addOrder()">–°–û–ó–î–ê–¢–¨</button>
            `;
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–µ–π—Å—Ç–≤–∏–π
        function addOrder() {
            const c = document.getElementById('ic').value;
            const p = document.getElementById('ip').value;
            const d = document.getElementById('id').value;
            const r = document.getElementById('ir').value;
            if(!c || !p) return msg('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è!');
            DB.orders.push({ c, p, d, ref: r, st: 'new' });
            save(); msg('–°–æ–∑–¥–∞–Ω–æ!'); go('orders');
        }

        function updSt(i, st) { DB.orders[i].st = st; save(); go('orders'); }
        function warn(ph) { let u=DB.users.find(x=>x.phone===ph); if(u){ u.warns++; save(); go('team'); msg('–í—ã–≥–æ–≤–æ—Ä –≤—ã–¥–∞–Ω!'); } }
        function renderFin() {
            let total = DB.orders.filter(o=>o.st==='done').reduce((a,b)=>a+Number(b.p), 0);
            document.getElementById('view').innerHTML = `<div style="text-align:center; padding-top:50px;"><small>–ö–ê–°–°–ê M.C.</small><h1 style="color:var(--gold)">${total} —Å–æ–º</h1></div>`;
        }

        // –°–∏—Å—Ç–µ–º–Ω—ã–µ
        function save() { localStorage.setItem('mc_v20_stable', JSON.stringify(DB)); }
        function msg(m) { const t=document.getElementById('toast'); t.innerText=m; t.style.display='block'; setTimeout(()=>t.style.display='none', 2000); }
        function toggleReg(s) { document.getElementById('l-box').style.display=s?'none':'block'; document.getElementById('r-box').style.display=s?'block':'none'; }
        function clearCache() { localStorage.clear(); location.reload(); }
    </script>
</body>
</html>
